<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ivy.ivy_tests.test_ivy.helpers &mdash; Ivy 1.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="icon" type="image/png" href="https://github.com/unifyai/unifyai.github.io/blob/master/img/externally_linked/ivy_logo_only.png?raw=true">
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> Ivy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deep_dive.html">Deep Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/constants.html">Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/creation.html">Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/data_type.html">Data type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/device.html">Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/elementwise.html">Elementwise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/general.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/gradients.html">Gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/linear_algebra.html">Linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/losses.html">Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/manipulation.html">Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/meta.html">Meta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/nest.html">Nest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/random.html">Random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/searching.html">Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/set.html">Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/sorting.html">Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/statistical.html">Statistical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functional/ivy/utility.html">Utility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../data_classes/container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data_classes/array.html">Array</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Framework Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/initializers.html">Initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/optimizers.html">Optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/module.html">Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful/sequential.html">Sequential</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ivy tests</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../ivy_tests/test_array_api.html">Test array api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ivy_tests/test_ivy.html">Test ivy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ivy_tests/conftest.html">Conftest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ivy_tests/test_docstrings.html">Test docstrings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ivy_tests/write_array_api_tests_k_flag.html">Write array api tests k flag</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ivy"">Ivy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mech"">Ivy mech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../vision"">Ivy vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../robot"">Ivy robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../gym"">Ivy gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../memory"">Ivy memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../builder"">Ivy builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../models"">Ivy models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ecosystem"">Ivy ecosystem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Ivy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      <li>ivy.ivy_tests.test_ivy.helpers</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ivy.ivy_tests.test_ivy.helpers</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Collection of helpers for ivy unit tests.&quot;&quot;&quot;</span>

<span class="c1"># global</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">settings</span>
<span class="kn">import</span> <span class="nn">hypothesis.extra.numpy</span> <span class="k">as</span> <span class="nn">nph</span>  <span class="c1"></span>
<span class="kn">from</span> <span class="nn">hypothesis.internal.floats</span> <span class="kn">import</span> <span class="n">float_of</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">mul</span>

<span class="c1"># local</span>
<span class="kn">from</span> <span class="nn">ivy.functional.backends.jax.general</span> <span class="kn">import</span> <span class="n">is_native_array</span> <span class="k">as</span> <span class="n">is_jax_native_array</span>
<span class="kn">from</span> <span class="nn">ivy.functional.backends.numpy.general</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_native_array</span> <span class="k">as</span> <span class="n">is_numpy_native_array</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ivy.functional.backends.tensorflow.general</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_native_array</span> <span class="k">as</span> <span class="n">is_tensorflow_native_array</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ivy.functional.backends.torch.general</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_native_array</span> <span class="k">as</span> <span class="n">is_torch_native_array</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ivy_tests.test_ivy.test_frontends</span> <span class="kn">import</span> <span class="n">NativeClass</span>
<span class="kn">from</span> <span class="nn">ivy_tests.test_ivy.test_frontends.test_torch</span> <span class="kn">import</span> <span class="n">convtorch</span>
<span class="kn">from</span> <span class="nn">ivy_tests.test_ivy.test_frontends.test_numpy</span> <span class="kn">import</span> <span class="n">convnumpy</span>
<span class="kn">from</span> <span class="nn">ivy_tests.test_ivy.test_frontends.test_tensorflow</span> <span class="kn">import</span> <span class="n">convtensor</span>
<span class="kn">from</span> <span class="nn">ivy_tests.test_ivy.test_frontends.test_jax</span> <span class="kn">import</span> <span class="n">convjax</span>
<span class="kn">import</span> <span class="nn">ivy.func_wrapper</span>


<span class="n">TOLERANCE_DICT</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;float16&quot;</span><span class="p">:</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">}</span>
<span class="n">cmd_line_args</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;as_variable&quot;</span><span class="p">,</span>
    <span class="s2">&quot;native_array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;with_out&quot;</span><span class="p">,</span>
    <span class="s2">&quot;container&quot;</span><span class="p">,</span>
    <span class="s2">&quot;instance_method&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_gradients&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">frontend_fw</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

    <span class="n">physical_devices</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s2">&quot;GPU&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">physical_devices</span><span class="p">:</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">set_memory_growth</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="kc">None</span>
<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="c1"># local</span>
<span class="kn">import</span> <span class="nn">ivy</span>
<span class="kn">import</span> <span class="nn">ivy.functional.backends.numpy</span> <span class="k">as</span> <span class="nn">ivy_np</span>


<div class="viewcode-block" id="convtrue"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/convtrue.html#ivy.ivy_tests.test_ivy.helpers.convtrue">[docs]</a><span class="k">def</span> <span class="nf">convtrue</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert NativeClass in argument to true framework counter part&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">NativeClass</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">argument</span><span class="o">.</span><span class="n">_native_class</span>
    <span class="k">return</span> <span class="n">argument</span></div>


<div class="viewcode-block" id="get_ivy_numpy"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_ivy_numpy.html#ivy.ivy_tests.test_ivy.helpers.get_ivy_numpy">[docs]</a><span class="k">def</span> <span class="nf">get_ivy_numpy</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Import Numpy module from ivy&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ivy.functional.backends.numpy</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">numpy</span></div>


<div class="viewcode-block" id="get_ivy_jax"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_ivy_jax.html#ivy.ivy_tests.test_ivy.helpers.get_ivy_jax">[docs]</a><span class="k">def</span> <span class="nf">get_ivy_jax</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Import JAX module from ivy&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ivy.functional.backends.jax</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">jax</span></div>


<div class="viewcode-block" id="get_ivy_tensorflow"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_ivy_tensorflow.html#ivy.ivy_tests.test_ivy.helpers.get_ivy_tensorflow">[docs]</a><span class="k">def</span> <span class="nf">get_ivy_tensorflow</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Import Tensorflow module from ivy&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ivy.functional.backends.tensorflow</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">tensorflow</span></div>


<div class="viewcode-block" id="get_ivy_torch"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_ivy_torch.html#ivy.ivy_tests.test_ivy.helpers.get_ivy_torch">[docs]</a><span class="k">def</span> <span class="nf">get_ivy_torch</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Import Torch module from ivy&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ivy.functional.backends.torch</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">torch</span></div>


<div class="viewcode-block" id="get_valid_numeric_dtypes"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_valid_numeric_dtypes.html#ivy.ivy_tests.test_ivy.helpers.get_valid_numeric_dtypes">[docs]</a><span class="k">def</span> <span class="nf">get_valid_numeric_dtypes</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">valid_numeric_dtypes</span></div>


<span class="n">_ivy_fws_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;numpy&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">get_ivy_numpy</span><span class="p">(),</span>
    <span class="s2">&quot;jax&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">get_ivy_jax</span><span class="p">(),</span>
    <span class="s2">&quot;tensorflow&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">get_ivy_tensorflow</span><span class="p">(),</span>
    <span class="s2">&quot;tensorflow_graph&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">get_ivy_tensorflow</span><span class="p">(),</span>
    <span class="s2">&quot;torch&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">get_ivy_torch</span><span class="p">(),</span>
<span class="p">}</span>

<span class="n">_iterable_types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
<span class="n">_excluded</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">_convert_vars</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">vars_in</span><span class="p">,</span> <span class="n">from_type</span><span class="p">,</span> <span class="n">to_type_callable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_other</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">to_type</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="n">new_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_in</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_iterable_types</span><span class="p">:</span>
            <span class="n">return_val</span> <span class="o">=</span> <span class="n">_convert_vars</span><span class="p">(</span>
                <span class="n">vars_in</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">from_type</span><span class="o">=</span><span class="n">from_type</span><span class="p">,</span> <span class="n">to_type_callable</span><span class="o">=</span><span class="n">to_type_callable</span>
            <span class="p">)</span>
            <span class="n">new_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">return_val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">from_type</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">stride</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">stride</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">strides</span><span class="p">])):</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">to_type_callable</span><span class="p">:</span>
                <span class="n">new_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_type_callable</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid. A conversion callable is required.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">to_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">to_type</span><span class="p">):</span>
            <span class="n">new_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">keep_other</span><span class="p">:</span>
            <span class="n">new_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_vars</span>


<div class="viewcode-block" id="var_fn"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/var_fn.html#ivy.ivy_tests.test_ivy.helpers.var_fn">[docs]</a><span class="k">def</span> <span class="nf">var_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns x as an Ivy Variable wrapping an Ivy Array with given dtype and device&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_current_frontend"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_current_frontend.html#ivy.ivy_tests.test_ivy.helpers.get_current_frontend">[docs]</a><span class="k">def</span> <span class="nf">get_current_frontend</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Returns the current frontend framework, returns None if no frontend is set.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">frontend_fw</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_dtypes"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_dtypes.html#ivy.ivy_tests.test_ivy.helpers.get_dtypes">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">get_dtypes</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draws a valid dtypes for the test function. For frontend tests,</span>
<span class="sd">    it draws the data types from the intersection between backend</span>
<span class="sd">    framework data types and frontend framework dtypes, otherwise,</span>
<span class="sd">    draws it from backend framework data types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    kind</span>
<span class="sd">        Supported types are integer, float, valid, numeric, and unsigned</span>
<span class="sd">    index</span>
<span class="sd">        list indexing incase a test needs to be skipped for a particular dtype(s)</span>
<span class="sd">    full</span>
<span class="sd">        returns the complete list of valid types</span>
<span class="sd">    none</span>
<span class="sd">        allow none in the list of valid types</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        dtype string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_type_dict</span><span class="p">(</span><span class="n">framework</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">framework</span><span class="o">.</span><span class="n">valid_dtypes</span><span class="p">,</span>
            <span class="s2">&quot;numeric&quot;</span><span class="p">:</span> <span class="n">framework</span><span class="o">.</span><span class="n">valid_numeric_dtypes</span><span class="p">,</span>
            <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="n">framework</span><span class="o">.</span><span class="n">valid_float_dtypes</span><span class="p">,</span>
            <span class="s2">&quot;integer&quot;</span><span class="p">:</span> <span class="n">framework</span><span class="o">.</span><span class="n">valid_int_dtypes</span><span class="p">,</span>
            <span class="s2">&quot;unsigned&quot;</span><span class="p">:</span> <span class="n">framework</span><span class="o">.</span><span class="n">valid_uint_dtypes</span><span class="p">,</span>
            <span class="s2">&quot;signed_integer&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">framework</span><span class="o">.</span><span class="n">valid_int_dtypes</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">framework</span><span class="o">.</span><span class="n">valid_uint_dtypes</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">}</span>

    <span class="n">backend_dtypes</span> <span class="o">=</span> <span class="n">_get_type_dict</span><span class="p">(</span><span class="n">ivy</span><span class="p">)[</span><span class="n">kind</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">frontend_fw</span><span class="p">:</span>
        <span class="n">fw_dtypes</span> <span class="o">=</span> <span class="n">_get_type_dict</span><span class="p">(</span><span class="n">frontend_fw</span><span class="p">())[</span><span class="n">kind</span><span class="p">]</span>
        <span class="n">valid_dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fw_dtypes</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">backend_dtypes</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid_dtypes</span> <span class="o">=</span> <span class="n">backend_dtypes</span>

    <span class="k">if</span> <span class="n">none</span><span class="p">:</span>
        <span class="n">valid_dtypes</span> <span class="o">+=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valid_dtypes</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">valid_dtypes</span><span class="p">[</span><span class="n">index</span><span class="p">:]))</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">valid_dtypes</span><span class="p">[</span><span class="n">index</span><span class="p">:]),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ret</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_castable_dtype"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_castable_dtype.html#ivy.ivy_tests.test_ivy.helpers.get_castable_dtype">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">get_castable_dtype</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">available_dtypes</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draws castable dtypes for the given dtype based on the current backend.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        Special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    available_dtypes</span>
<span class="sd">        Castable data types are drawn from this list randomly.</span>
<span class="sd">    dtype</span>
<span class="sd">        Data type from which to cast.</span>
<span class="sd">    x</span>
<span class="sd">        Optional list of values to cast.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        A tuple of inputs and castable dtype.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">cast_filter</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_int_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
        <span class="k">elif</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_float_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">max_x</span> <span class="o">&lt;=</span> <span class="n">max_val</span> <span class="ow">and</span> <span class="n">ivy</span><span class="o">.</span><span class="n">dtype_bits</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">dtype_bits</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="n">cast_dtype</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">available_dtypes</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cast_filter</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">cast_dtype</span>
    <span class="k">if</span> <span class="s2">&quot;uint&quot;</span> <span class="ow">in</span> <span class="n">cast_dtype</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">cast_dtype</span></div>


<div class="viewcode-block" id="floats"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/floats.html#ivy.ivy_tests.test_ivy.helpers.floats">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">floats</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_min</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">exclude_max</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">safety_factor</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
    <span class="n">small_value_safety_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws an arbitrarily sized list of floats with a safety factor applied</span>
<span class="sd">        to avoid values being generated at the edge of a dtype limit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    min_value</span>
<span class="sd">        minimum value of floats generated.</span>
<span class="sd">    max_value</span>
<span class="sd">        maximum value of floats generated.</span>
<span class="sd">    allow_nan</span>
<span class="sd">        if True, allow Nans in the list.</span>
<span class="sd">    allow_inf</span>
<span class="sd">        if True, allow inf in the list.</span>
<span class="sd">    allow_subnormal</span>
<span class="sd">        if True, allow subnormals in the list.</span>
<span class="sd">    width</span>
<span class="sd">        The width argument specifies the maximum number of bits of precision</span>
<span class="sd">        required to represent the generated float. Valid values are 16, 32, or 64.</span>
<span class="sd">    exclude_min</span>
<span class="sd">        if True, exclude the minimum limit.</span>
<span class="sd">    exclude_max</span>
<span class="sd">        if True, exclude the maximum limit.</span>
<span class="sd">    safety_factor</span>
<span class="sd">        default = 0.99. Only values which are 99% or less than the edge of</span>
<span class="sd">        the limit for a given dtype are generated.</span>
<span class="sd">    small_value_safety_factor</span>
<span class="sd">        default = 1.1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        list of floats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lim_float16</span> <span class="o">=</span> <span class="mi">65504</span>
    <span class="n">lim_float32</span> <span class="o">=</span> <span class="mf">3.4028235e38</span>
    <span class="n">lim_float64</span> <span class="o">=</span> <span class="mf">1.7976931348623157e308</span>

    <span class="k">if</span> <span class="n">min_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">min_value</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">lim_float16</span> <span class="o">*</span> <span class="n">safety_factor</span>
            <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;</span> <span class="n">lim_float16</span> <span class="o">*</span> <span class="n">safety_factor</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">width</span> <span class="o">==</span> <span class="mi">16</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="c1"># dtype float16</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">min_value</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">lim_float32</span> <span class="o">*</span> <span class="n">safety_factor</span>
            <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;</span> <span class="n">lim_float32</span> <span class="o">*</span> <span class="n">safety_factor</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">width</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="c1"># dtype float32</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># dtype float64</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">64</span>

        <span class="n">min_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                <span class="n">allow_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">,</span>
                <span class="n">allow_subnormal</span><span class="o">=</span><span class="n">allow_subnormal</span><span class="p">,</span>
                <span class="n">allow_infinity</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">min_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">min_value</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">lim_float16</span> <span class="o">*</span> <span class="n">safety_factor</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">width</span> <span class="o">==</span> <span class="mi">16</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">dtype_min</span> <span class="o">=</span> <span class="s2">&quot;float16&quot;</span>
            <span class="k">elif</span> <span class="n">min_value</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">lim_float32</span> <span class="o">*</span> <span class="n">safety_factor</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">width</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">dtype_min</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype_min</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype_min</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">ivy_np</span><span class="o">.</span><span class="n">valid_float_dtypes</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">max_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">max_value</span> <span class="o">&lt;</span> <span class="n">lim_float16</span> <span class="o">*</span> <span class="n">safety_factor</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">width</span> <span class="o">==</span> <span class="mi">16</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">dtype_max</span> <span class="o">=</span> <span class="s2">&quot;float16&quot;</span>
            <span class="k">elif</span> <span class="n">max_value</span> <span class="o">&lt;</span> <span class="n">lim_float32</span> <span class="o">*</span> <span class="n">safety_factor</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">width</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">dtype_max</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype_max</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype_max</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">ivy_np</span><span class="o">.</span><span class="n">valid_float_dtypes</span><span class="p">))</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">promote_types</span><span class="p">(</span><span class="n">dtype_min</span><span class="p">,</span> <span class="n">dtype_max</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float16&quot;</span> <span class="ow">or</span> <span class="mi">16</span> <span class="o">==</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="o">-</span><span class="n">lim_float16</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="n">lim_float16</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;bfloat16&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">32</span> <span class="o">==</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">32</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="o">-</span><span class="n">lim_float32</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="n">lim_float32</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">64</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="o">-</span><span class="n">lim_float64</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">float_of</span><span class="p">(</span><span class="n">lim_float64</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                <span class="n">allow_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">,</span>
                <span class="n">allow_subnormal</span><span class="o">=</span><span class="n">allow_subnormal</span><span class="p">,</span>
                <span class="n">allow_infinity</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="ints"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/ints.html#ivy.ivy_tests.test_ivy.helpers.ints">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">ints</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safety_factor</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws an arbitrarily sized list of integers with a safety factor</span>
<span class="sd">    applied to values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    min_value</span>
<span class="sd">        minimum value of integers generated.</span>
<span class="sd">    max_value</span>
<span class="sd">        maximum value of integers generated.</span>
<span class="sd">    safety_factor</span>
<span class="sd">        default = 0.95. Only values which are 95% or less than the edge of</span>
<span class="sd">        the limit for a given dtype are generated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        list of integers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">ivy_np</span><span class="o">.</span><span class="n">valid_int_dtypes</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;int8&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">127</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;int16&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">32768</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">32767</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;int32&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">2147483648</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">2147483647</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;int64&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">9223372036854775808</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">9223372036854775807</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;uint8&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;uint16&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">65535</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;uint32&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">4294967295</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;uint64&quot;</span><span class="p">:</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">18446744073709551615</span> <span class="o">*</span> <span class="n">safety_factor</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">))</span></div>


<div class="viewcode-block" id="ints_or_floats"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/ints_or_floats.html#ivy.ivy_tests.test_ivy.helpers.ints_or_floats">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">ints_or_floats</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safety_factor</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws integers or floats with a safety factor</span>
<span class="sd">    applied to values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    min_value</span>
<span class="sd">        minimum value of integers generated.</span>
<span class="sd">    max_value</span>
<span class="sd">        maximum value of integers generated.</span>
<span class="sd">    safety_factor</span>
<span class="sd">        default = 0.95. Only values which are 95% or less than the edge of</span>
<span class="sd">        the limit for a given dtype are generated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        integer or float.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">ints</span><span class="p">(</span>
            <span class="n">min_value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">min_value</span><span class="p">),</span>
            <span class="n">max_value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">max_value</span><span class="p">),</span>
            <span class="n">safety_factor</span><span class="o">=</span><span class="n">safety_factor</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">|</span> <span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span> <span class="n">safety_factor</span><span class="o">=</span><span class="n">safety_factor</span><span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="assert_all_close"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/assert_all_close.html#ivy.ivy_tests.test_ivy.helpers.assert_all_close">[docs]</a><span class="k">def</span> <span class="nf">assert_all_close</span><span class="p">(</span>
    <span class="n">ret_np</span><span class="p">,</span> <span class="n">ret_from_gt_np</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">,</span> <span class="n">ground_truth_backend</span><span class="o">=</span><span class="s2">&quot;TensorFlow&quot;</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Matches the ret_np and ret_from_np inputs element-by-element to ensure that</span>
<span class="sd">    they are the same.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ret_np</span>
<span class="sd">        Return from the framework to test. Ivy Container or Numpy Array.</span>
<span class="sd">    ret_from_gt_np</span>
<span class="sd">        Return from the ground truth framework. Ivy Container or Numpy Array.</span>
<span class="sd">    rtol</span>
<span class="sd">        Relative Tolerance Value.</span>
<span class="sd">    atol</span>
<span class="sd">        Absolute Tolerance Value.</span>
<span class="sd">    ground_truth_backend</span>
<span class="sd">        Ground Truth Backend Framework.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None if the test passes, else marks the test as failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret_dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret_np</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">ret_from_gt_dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret_from_gt_np</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;longlong&quot;</span><span class="p">,</span> <span class="s2">&quot;int64&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ret_dtype</span> <span class="o">==</span> <span class="n">ret_from_gt_dtype</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">&quot;the return with a </span><span class="si">{}</span><span class="s2"> backend produced data type of </span><span class="si">{}</span><span class="s2">, while the return with&quot;</span>
        <span class="s2">&quot; a </span><span class="si">{}</span><span class="s2"> backend returned a data type of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">ground_truth_backend</span><span class="p">,</span>
            <span class="n">ret_from_gt_dtype</span><span class="p">,</span>
            <span class="n">ivy</span><span class="o">.</span><span class="n">current_backend_str</span><span class="p">(),</span>
            <span class="n">ret_dtype</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_container</span><span class="p">(</span><span class="n">ret_np</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_container</span><span class="p">(</span><span class="n">ret_from_gt_np</span><span class="p">):</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">multi_map</span><span class="p">(</span><span class="n">assert_all_close</span><span class="p">,</span> <span class="p">[</span><span class="n">ret_np</span><span class="p">,</span> <span class="n">ret_from_gt_np</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ret_np</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;bfloat16&quot;</span> <span class="ow">or</span> <span class="n">ret_from_gt_np</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;bfloat16&quot;</span><span class="p">:</span>
            <span class="n">ret_np</span> <span class="o">=</span> <span class="n">ret_np</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
            <span class="n">ret_from_gt_np</span> <span class="o">=</span> <span class="n">ret_from_gt_np</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ret_np</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ret_from_gt_np</span><span class="p">),</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span>
        <span class="p">),</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> != </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_np</span><span class="p">,</span> <span class="n">ret_from_gt_np</span><span class="p">)</span></div>


<div class="viewcode-block" id="assert_same_type_and_shape"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/assert_same_type_and_shape.html#ivy.ivy_tests.test_ivy.helpers.assert_same_type_and_shape">[docs]</a><span class="k">def</span> <span class="nf">assert_same_type_and_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">this_key_chain</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">values</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s2">&quot;type(x) = </span><span class="si">{}</span><span class="s2">, type(y) = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;x.shape = </span><span class="si">{}</span><span class="s2">, y.shape = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;x.dtype = </span><span class="si">{}</span><span class="s2">, y.dtype = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="kwargs_to_args_n_kwargs"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/kwargs_to_args_n_kwargs.html#ivy.ivy_tests.test_ivy.helpers.kwargs_to_args_n_kwargs">[docs]</a><span class="k">def</span> <span class="nf">kwargs_to_args_n_kwargs</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">num_positional_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Splits the kwargs into args and kwargs, with the first num_positional_args ported</span>
<span class="sd">    to args.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">())[:</span><span class="n">num_positional_args</span><span class="p">]]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">num_positional_args</span><span class="p">:]}</span>
    <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span></div>


<div class="viewcode-block" id="list_of_length"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/list_of_length.html#ivy.ivy_tests.test_ivy.helpers.list_of_length">[docs]</a><span class="k">def</span> <span class="nf">list_of_length</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a random list of the given length from elements in x.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">length</span><span class="p">)</span></div>


<div class="viewcode-block" id="as_cont"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/as_cont.html#ivy.ivy_tests.test_ivy.helpers.as_cont">[docs]</a><span class="k">def</span> <span class="nf">as_cont</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns x as an Ivy Container, containing x at all its leaves.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">}})</span></div>


<div class="viewcode-block" id="as_lists"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/as_lists.html#ivy.ivy_tests.test_ivy.helpers.as_lists">[docs]</a><span class="k">def</span> <span class="nf">as_lists</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Changes the elements in args to be of type list.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="flatten_fw"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/flatten_fw.html#ivy.ivy_tests.test_ivy.helpers.flatten_fw">[docs]</a><span class="k">def</span> <span class="nf">flatten_fw</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">fw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a flattened numpy version of the arrays in ret for a given framework.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">fw</span> <span class="o">==</span> <span class="s2">&quot;jax&quot;</span><span class="p">:</span>
        <span class="n">ret_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span>
            <span class="n">ret</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_jax_native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">fw</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span><span class="p">:</span>
        <span class="n">ret_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span>
            <span class="n">ret</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_numpy_native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">fw</span> <span class="o">==</span> <span class="s2">&quot;tensorflow&quot;</span><span class="p">:</span>
        <span class="n">ret_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span>
            <span class="n">ret</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_tensorflow_native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span>
            <span class="n">ret</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_torch_native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">ret_flat</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">ret_idxs</span><span class="p">)</span>

    <span class="c1"># convert the return to NumPy</span>
    <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ret_flat</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ret_np_flat</span></div>


<div class="viewcode-block" id="flatten"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/flatten.html#ivy.ivy_tests.test_ivy.helpers.flatten">[docs]</a><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ret</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a flattened numpy version of the arrays in ret.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">,)</span>
    <span class="n">ret_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">ret_idxs</span><span class="p">)</span></div>


<div class="viewcode-block" id="flatten_and_to_np"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/flatten_and_to_np.html#ivy.ivy_tests.test_ivy.helpers.flatten_and_to_np">[docs]</a><span class="k">def</span> <span class="nf">flatten_and_to_np</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ret</span><span class="p">):</span>
    <span class="c1"># flatten the return</span>
    <span class="n">ret_flat</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">ret</span><span class="o">=</span><span class="n">ret</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ret_flat</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_ret_and_flattened_np_array"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_ret_and_flattened_np_array.html#ivy.ivy_tests.test_ivy.helpers.get_ret_and_flattened_np_array">[docs]</a><span class="k">def</span> <span class="nf">get_ret_and_flattened_np_array</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs func with args and kwargs, and returns the result along with its flattened</span>
<span class="sd">    version.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">flatten_and_to_np</span><span class="p">(</span><span class="n">ret</span><span class="o">=</span><span class="n">ret</span><span class="p">)</span></div>


<div class="viewcode-block" id="value_test"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/value_test.html#ivy.ivy_tests.test_ivy.helpers.value_test">[docs]</a><span class="k">def</span> <span class="nf">value_test</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ret_np_flat</span><span class="p">,</span>
    <span class="n">ret_np_from_gt_flat</span><span class="p">,</span>
    <span class="n">rtol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">ground_truth_backend</span><span class="o">=</span><span class="s2">&quot;TensorFlow&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs a value test for matching the arrays in ret_np_flat and</span>
<span class="sd">    ret_from_np_flat.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ret_np_flat</span>
<span class="sd">        A list (flattened) containing Numpy arrays. Return from the</span>
<span class="sd">        framework to test.</span>
<span class="sd">    ret_np_from_gt_flat</span>
<span class="sd">        A list (flattened) containing Numpy arrays. Return from the ground</span>
<span class="sd">        truth framework.</span>
<span class="sd">    rtol</span>
<span class="sd">        Relative Tolerance Value.</span>
<span class="sd">    atol</span>
<span class="sd">        Absolute Tolerance Value.</span>
<span class="sd">    ground_truth_backend</span>
<span class="sd">        Ground Truth Backend Framework.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None if the value test passes, else marks the test as failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ret_np_flat</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">ret_np_flat</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ret_np_from_gt_flat</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">ret_np_from_gt_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">ret_np_from_gt_flat</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_np_flat</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_np_from_gt_flat</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">&quot;len(ret_np_flat) != len(ret_np_from_gt_flat):</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;ret_np_flat:</span><span class="se">\n\n</span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">ret_np_from_gt_flat:</span><span class="se">\n\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">ret_np_flat</span><span class="p">,</span> <span class="n">ret_np_from_gt_flat</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># value tests, iterating through each array in the flattened returns</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rtol</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ret_np</span><span class="p">,</span> <span class="n">ret_np_from_gt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ret_np_flat</span><span class="p">,</span> <span class="n">ret_np_from_gt_flat</span><span class="p">):</span>
            <span class="n">rtol</span> <span class="o">=</span> <span class="n">TOLERANCE_DICT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ret_np_from_gt</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="mf">1e-03</span><span class="p">)</span>
            <span class="n">assert_all_close</span><span class="p">(</span>
                <span class="n">ret_np</span><span class="p">,</span>
                <span class="n">ret_np_from_gt</span><span class="p">,</span>
                <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span>
                <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
                <span class="n">ground_truth_backend</span><span class="o">=</span><span class="n">ground_truth_backend</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ret_np</span><span class="p">,</span> <span class="n">ret_np_from_gt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ret_np_flat</span><span class="p">,</span> <span class="n">ret_np_from_gt_flat</span><span class="p">):</span>
            <span class="n">assert_all_close</span><span class="p">(</span>
                <span class="n">ret_np</span><span class="p">,</span>
                <span class="n">ret_np_from_gt</span><span class="p">,</span>
                <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span>
                <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
                <span class="n">ground_truth_backend</span><span class="o">=</span><span class="n">ground_truth_backend</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="args_to_container"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/args_to_container.html#ivy.ivy_tests.test_ivy.helpers.args_to_container">[docs]</a><span class="k">def</span> <span class="nf">args_to_container</span><span class="p">(</span><span class="n">array_args</span><span class="p">):</span>
    <span class="n">array_args_container</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array_args</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">array_args_container</span></div>


<div class="viewcode-block" id="gradient_test"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/gradient_test.html#ivy.ivy_tests.test_ivy.helpers.gradient_test">[docs]</a><span class="k">def</span> <span class="nf">gradient_test</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">fn_name</span><span class="p">,</span>
    <span class="n">all_as_kwargs_np</span><span class="p">,</span>
    <span class="n">args_np</span><span class="p">,</span>
    <span class="n">kwargs_np</span><span class="p">,</span>
    <span class="n">input_dtypes</span><span class="p">,</span>
    <span class="n">as_variable_flags</span><span class="p">,</span>
    <span class="n">native_array_flags</span><span class="p">,</span>
    <span class="n">container_flags</span><span class="p">,</span>
    <span class="n">rtol_</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol_</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-06</span><span class="p">,</span>
    <span class="n">ground_truth_backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;torch&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">def</span> <span class="nf">grad_fn</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
        <span class="n">array_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">xs</span><span class="o">.</span><span class="n">to_iterator</span><span class="p">()]</span>
        <span class="n">arg_array_vals</span> <span class="o">=</span> <span class="n">array_vals</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">args_idxs</span><span class="p">)]</span>
        <span class="n">kwarg_array_vals</span> <span class="o">=</span> <span class="n">array_vals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">args_idxs</span><span class="p">)</span> <span class="p">:]</span>
        <span class="n">args_writeable</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">copy_nest</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">kwargs_writeable</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">copy_nest</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">set_nest_at_indices</span><span class="p">(</span><span class="n">args_writeable</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">arg_array_vals</span><span class="p">)</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">set_nest_at_indices</span><span class="p">(</span><span class="n">kwargs_writeable</span><span class="p">,</span> <span class="n">kwargs_idxs</span><span class="p">,</span> <span class="n">kwarg_array_vals</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ivy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">](</span><span class="o">*</span><span class="n">args_writeable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_writeable</span><span class="p">))</span>

    <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
        <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
        <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
        <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
        <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
        <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
        <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">arg_array_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">))</span>
    <span class="n">kwarg_array_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">kwargs_idxs</span><span class="p">))</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">args_to_container</span><span class="p">(</span><span class="n">arg_array_vals</span> <span class="o">+</span> <span class="n">kwarg_array_vals</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">execute_with_gradients</span><span class="p">,</span> <span class="n">grad_fn</span><span class="p">,</span> <span class="n">xs</span>
    <span class="p">)</span>
    <span class="n">grads_np_flat</span> <span class="o">=</span> <span class="n">ret_np_flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># compute the return with a Ground Truth backend</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="n">ground_truth_backend</span><span class="p">)</span>
    <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_dtype</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span>
        <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
        <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
        <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
        <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
        <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
        <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
        <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
        <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">arg_array_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">))</span>
    <span class="n">kwarg_array_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">kwargs_idxs</span><span class="p">))</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">args_to_container</span><span class="p">(</span><span class="n">arg_array_vals</span> <span class="o">+</span> <span class="n">kwarg_array_vals</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ret_np_from_gt_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">execute_with_gradients</span><span class="p">,</span> <span class="n">grad_fn</span><span class="p">,</span> <span class="n">xs</span>
    <span class="p">)</span>
    <span class="n">grads_np_from_gt_flat</span> <span class="o">=</span> <span class="n">ret_np_from_gt_flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
    <span class="c1"># value test</span>
    <span class="n">value_test</span><span class="p">(</span>
        <span class="n">ret_np_flat</span><span class="o">=</span><span class="n">grads_np_flat</span><span class="p">,</span>
        <span class="n">ret_np_from_gt_flat</span><span class="o">=</span><span class="n">grads_np_from_gt_flat</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="n">rtol_</span><span class="p">,</span>
        <span class="n">atol</span><span class="o">=</span><span class="n">atol_</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="check_unsupported_dtype"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/check_unsupported_dtype.html#ivy.ivy_tests.test_ivy.helpers.check_unsupported_dtype">[docs]</a><span class="k">def</span> <span class="nf">check_unsupported_dtype</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether a function does not support the input data types or the output</span>
<span class="sd">    data type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn</span>
<span class="sd">        The function to check.</span>
<span class="sd">    input_dtypes</span>
<span class="sd">        data-types of the input arguments and keyword-arguments.</span>
<span class="sd">    all_as_kwargs_np</span>
<span class="sd">        All arguments in Numpy Format, to check for the presence of dtype argument.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    True if the function does not support the given input or output data types, False</span>
<span class="sd">    otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">unsupported_dtypes_fn</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">function_unsupported_dtypes</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="n">supported_dtypes_fn</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">function_supported_dtypes</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unsupported_dtypes_fn</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">input_dtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">unsupported_dtypes_fn</span><span class="p">:</span>
                <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;dtype&quot;</span> <span class="ow">in</span> <span class="n">all_as_kwargs_np</span>
            <span class="ow">and</span> <span class="n">all_as_kwargs_np</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unsupported_dtypes_fn</span>
        <span class="p">):</span>
            <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">supported_dtypes_fn</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">input_dtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_dtypes_fn</span><span class="p">:</span>
                <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;dtype&quot;</span> <span class="ow">in</span> <span class="n">all_as_kwargs_np</span>
            <span class="ow">and</span> <span class="n">all_as_kwargs_np</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_dtypes_fn</span>
        <span class="p">):</span>
            <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">test_unsupported</span></div>


<div class="viewcode-block" id="check_unsupported_device"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/check_unsupported_device.html#ivy.ivy_tests.test_ivy.helpers.check_unsupported_device">[docs]</a><span class="k">def</span> <span class="nf">check_unsupported_device</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">input_device</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether a function does not support a given device.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn</span>
<span class="sd">        The function to check.</span>
<span class="sd">    input_device</span>
<span class="sd">        The backend device.</span>
<span class="sd">    all_as_kwargs_np</span>
<span class="sd">        All arguments in Numpy Format, to check for the presence of dtype argument.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    True if the function does not support the given device, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">unsupported_devices_fn</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">function_unsupported_devices</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="n">supported_devices_fn</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">function_supported_devices</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unsupported_devices_fn</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">input_device</span> <span class="ow">in</span> <span class="n">unsupported_devices_fn</span><span class="p">:</span>
            <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;device&quot;</span> <span class="ow">in</span> <span class="n">all_as_kwargs_np</span>
            <span class="ow">and</span> <span class="n">all_as_kwargs_np</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unsupported_devices_fn</span>
        <span class="p">):</span>
            <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">supported_devices_fn</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">input_device</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_devices_fn</span><span class="p">:</span>
            <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;device&quot;</span> <span class="ow">in</span> <span class="n">all_as_kwargs_np</span>
            <span class="ow">and</span> <span class="n">all_as_kwargs_np</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_devices_fn</span>
        <span class="p">):</span>
            <span class="n">test_unsupported</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">test_unsupported</span></div>


<div class="viewcode-block" id="check_unsupported_device_and_dtype"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/check_unsupported_device_and_dtype.html#ivy.ivy_tests.test_ivy.helpers.check_unsupported_device_and_dtype">[docs]</a><span class="k">def</span> <span class="nf">check_unsupported_device_and_dtype</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether a function does not support a given device or data types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn</span>
<span class="sd">        The function to check.</span>
<span class="sd">    device</span>
<span class="sd">        The backend device to check.</span>
<span class="sd">    input_dtypes</span>
<span class="sd">        data-types of the input arguments and keyword-arguments.</span>
<span class="sd">    all_as_kwargs_np</span>
<span class="sd">        All arguments in Numpy Format, to check for the presence of dtype argument.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    True if the function does not support both the device and any data type, False</span>
<span class="sd">    otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unsupported_devices_dtypes_fn</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">function_unsupported_devices_and_dtypes</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">unsupported_devices_dtypes_fn</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">input_dtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">unsupported_devices_dtypes_fn</span><span class="p">[</span><span class="n">device</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="s2">&quot;device&quot;</span> <span class="ow">in</span> <span class="n">all_as_kwargs_np</span> <span class="ow">and</span> <span class="s2">&quot;dtype&quot;</span> <span class="ow">in</span> <span class="n">all_as_kwargs_np</span><span class="p">:</span>
        <span class="n">dev</span> <span class="o">=</span> <span class="n">all_as_kwargs_np</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">all_as_kwargs_np</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">unsupported_devices_dtypes_fn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="create_args_kwargs"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/create_args_kwargs.html#ivy.ivy_tests.test_ivy.helpers.create_args_kwargs">[docs]</a><span class="k">def</span> <span class="nf">create_args_kwargs</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">args_np</span><span class="p">,</span>
    <span class="n">kwargs_np</span><span class="p">,</span>
    <span class="n">input_dtypes</span><span class="p">,</span>
    <span class="n">as_variable_flags</span><span class="p">,</span>
    <span class="n">native_array_flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">container_flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates arguments and keyword-arguments for the function to test.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args_np</span>
<span class="sd">        A dictionary of arguments in Numpy.</span>
<span class="sd">    kwargs_np</span>
<span class="sd">        A dictionary of keyword-arguments in Numpy.</span>
<span class="sd">    input_dtypes</span>
<span class="sd">        data-types of the input arguments and keyword-arguments.</span>
<span class="sd">    as_variable_flags</span>
<span class="sd">        A list of booleans. if True for a corresponding input argument, it is called</span>
<span class="sd">        as an Ivy Variable.</span>
<span class="sd">    native_array_flags</span>
<span class="sd">        if not None, the corresponding argument is called as a Native Array.</span>
<span class="sd">    container_flags</span>
<span class="sd">        if not None, the corresponding argument is called as an Ivy Container.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Arguments, Keyword-arguments, number of arguments, and indexes on arguments and</span>
<span class="sd">    keyword-arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># extract all arrays from the arguments and keyword arguments</span>
    <span class="n">args_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span><span class="n">args_np</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
    <span class="n">arg_np_vals</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">args_np</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">)</span>
    <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span><span class="n">kwargs_np</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
    <span class="n">kwarg_np_vals</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">kwargs_np</span><span class="p">,</span> <span class="n">kwargs_idxs</span><span class="p">)</span>

    <span class="c1"># assert that the number of arrays aligns with the dtypes and as_variable_flags</span>
    <span class="n">num_arrays</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_np_vals</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwarg_np_vals</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_arrays</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">num_arrays</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;Found </span><span class="si">{}</span><span class="s2"> arrays in the input arguments, but </span><span class="si">{}</span><span class="s2"> dtypes and &quot;</span>
            <span class="s2">&quot;as_variable_flags. Make sure to pass in a sequence of bools for all &quot;</span>
            <span class="s2">&quot;associated boolean flag inputs to test_function, with the sequence length &quot;</span>
            <span class="s2">&quot;being equal to the number of arrays in the arguments.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">num_arrays</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># create args</span>
    <span class="n">num_arg_vals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_np_vals</span><span class="p">)</span>
    <span class="n">arg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg_np_vals</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="p">[:</span><span class="n">num_arg_vals</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="n">arg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="n">x</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg_array_vals</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">[:</span><span class="n">num_arg_vals</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">native_array_flags</span><span class="p">:</span>
        <span class="n">arg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ivy</span><span class="o">.</span><span class="n">to_native</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="k">else</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg_array_vals</span><span class="p">,</span> <span class="n">native_array_flags</span><span class="p">[:</span><span class="n">num_arg_vals</span><span class="p">])</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="n">container_flags</span><span class="p">:</span>
        <span class="n">arg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">as_cont</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg_array_vals</span><span class="p">,</span> <span class="n">container_flags</span><span class="p">[:</span><span class="n">num_arg_vals</span><span class="p">])</span>
        <span class="p">]</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">copy_nest</span><span class="p">(</span><span class="n">args_np</span><span class="p">,</span> <span class="n">to_mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">set_nest_at_indices</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">arg_array_vals</span><span class="p">)</span>

    <span class="c1"># create kwargs</span>
    <span class="n">kwarg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">kwarg_np_vals</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="p">[</span><span class="n">num_arg_vals</span><span class="p">:])</span>
    <span class="p">]</span>
    <span class="n">kwarg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="n">x</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">kwarg_array_vals</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">[</span><span class="n">num_arg_vals</span><span class="p">:])</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">native_array_flags</span><span class="p">:</span>
        <span class="n">kwarg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ivy</span><span class="o">.</span><span class="n">to_native</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="k">else</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">kwarg_array_vals</span><span class="p">,</span> <span class="n">native_array_flags</span><span class="p">[</span><span class="n">num_arg_vals</span><span class="p">:])</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="n">container_flags</span><span class="p">:</span>
        <span class="n">kwarg_array_vals</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">as_cont</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">kwarg_array_vals</span><span class="p">,</span> <span class="n">container_flags</span><span class="p">[</span><span class="n">num_arg_vals</span><span class="p">:])</span>
        <span class="p">]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">copy_nest</span><span class="p">(</span><span class="n">kwargs_np</span><span class="p">,</span> <span class="n">to_mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">set_nest_at_indices</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">kwargs_idxs</span><span class="p">,</span> <span class="n">kwarg_array_vals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_arg_vals</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span></div>


<div class="viewcode-block" id="test_unsupported_function"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/test_unsupported_function.html#ivy.ivy_tests.test_ivy.helpers.test_unsupported_function">[docs]</a><span class="k">def</span> <span class="nf">test_unsupported_function</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests a function with an unsupported datatype to raise an exception.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn</span>
<span class="sd">        callable function to test.</span>
<span class="sd">    args</span>
<span class="sd">        arguments to the function.</span>
<span class="sd">    kwargs</span>
<span class="sd">        keyword-arguments to the function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">assert</span> <span class="kc">False</span>
    <span class="k">except</span><span class="p">:</span>  <span class="c1"></span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="test_method"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/test_method.html#ivy.ivy_tests.test_ivy.helpers.test_method">[docs]</a><span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">input_dtypes_init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">as_variable_flags_init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_positional_args_init</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">native_array_flags_init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">all_as_kwargs_np_init</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">input_dtypes_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">]],</span>
    <span class="n">as_variable_flags_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">num_positional_args_method</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">native_array_flags_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">container_flags_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">all_as_kwargs_np_method</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">fw</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;__call__&quot;</span><span class="p">,</span>
    <span class="n">init_with_v</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">method_with_v</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">rtol_</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol_</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-06</span><span class="p">,</span>
    <span class="n">test_values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">test_gradients</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ground_truth_backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
    <span class="n">device_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests a class-method that consumes (or returns) arrays for the current backend</span>
<span class="sd">    by comparing the result with numpy.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_dtypes_init</span>
<span class="sd">        data types of the input arguments to the constructor in order.</span>
<span class="sd">    as_variable_flags_init</span>
<span class="sd">        dictates whether the corresponding input argument passed to the constructor</span>
<span class="sd">        should be treated as an ivy.Variable.</span>
<span class="sd">    num_positional_args_init</span>
<span class="sd">        number of input arguments that must be passed as positional arguments to the</span>
<span class="sd">        constructor.</span>
<span class="sd">    native_array_flags_init</span>
<span class="sd">        dictates whether the corresponding input argument passed to the constructor</span>
<span class="sd">        should be treated as a native array.</span>
<span class="sd">    all_as_kwargs_np_init:</span>
<span class="sd">        input arguments to the constructor as keyword arguments.</span>
<span class="sd">    input_dtypes_method</span>
<span class="sd">        data types of the input arguments to the method in order.</span>
<span class="sd">    as_variable_flags_method</span>
<span class="sd">        dictates whether the corresponding input argument passed to the method should</span>
<span class="sd">        be treated as an ivy.Variable.</span>
<span class="sd">    num_positional_args_method</span>
<span class="sd">        number of input arguments that must be passed as positional arguments to the</span>
<span class="sd">        method.</span>
<span class="sd">    native_array_flags_method</span>
<span class="sd">        dictates whether the corresponding input argument passed to the method should</span>
<span class="sd">        be treated as a native array.</span>
<span class="sd">    container_flags_method</span>
<span class="sd">        dictates whether the corresponding input argument passed to the method should</span>
<span class="sd">        be treated as an ivy Container.</span>
<span class="sd">    all_as_kwargs_np_method:</span>
<span class="sd">        input arguments to the method as keyword arguments.</span>
<span class="sd">    fw</span>
<span class="sd">        current backend (framework).</span>
<span class="sd">    class_name</span>
<span class="sd">        name of the class to test.</span>
<span class="sd">    method_name</span>
<span class="sd">        name of tthe method to test.</span>
<span class="sd">    init_with_v</span>
<span class="sd">        if the class being tested is an ivy.Module, then setting this flag as True will</span>
<span class="sd">        call the constructor with the variables v passed explicitly.</span>
<span class="sd">    method_with_v</span>
<span class="sd">        if the class being tested is an ivy.Module, then setting this flag as True will</span>
<span class="sd">        call the method with the variables v passed explicitly.</span>
<span class="sd">    rtol_</span>
<span class="sd">        relative tolerance value.</span>
<span class="sd">    atol_</span>
<span class="sd">        absolute tolerance value.</span>
<span class="sd">    test_values</span>
<span class="sd">        can be a bool or a string to indicate whether correctness of values should be</span>
<span class="sd">        tested. If the value is `with_v`, shapes are tested but not values.</span>
<span class="sd">    ground_truth_backend</span>
<span class="sd">        Ground Truth Backend to compare the result-values.</span>
<span class="sd">    device_</span>
<span class="sd">        The device on which to create arrays.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        optional, return value from the function</span>
<span class="sd">    ret_gt</span>
<span class="sd">        optional, return value from the Ground Truth function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert single values to length 1 lists</span>
    <span class="p">(</span><span class="n">input_dtypes_init</span><span class="p">,</span> <span class="n">as_variable_flags_init</span><span class="p">,</span> <span class="n">native_array_flags_init</span><span class="p">,)</span> <span class="o">=</span> <span class="n">as_lists</span><span class="p">(</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">input_dtypes_init</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">as_variable_flags_init</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">native_array_flags_init</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">)</span>
    <span class="n">all_as_kwargs_np_init</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">all_as_kwargs_np_init</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
    <span class="p">(</span>
        <span class="n">input_dtypes_method</span><span class="p">,</span>
        <span class="n">as_variable_flags_method</span><span class="p">,</span>
        <span class="n">native_array_flags_method</span><span class="p">,</span>
        <span class="n">container_flags_method</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">as_lists</span><span class="p">(</span>
        <span class="n">input_dtypes_method</span><span class="p">,</span>
        <span class="n">as_variable_flags_method</span><span class="p">,</span>
        <span class="n">native_array_flags_method</span><span class="p">,</span>
        <span class="n">container_flags_method</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># make all lists equal in length</span>
    <span class="n">num_arrays_constructor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes_init</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags_init</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags_init</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes_init</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays_constructor</span><span class="p">:</span>
        <span class="n">input_dtypes_init</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">input_dtypes_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays_constructor</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags_init</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays_constructor</span><span class="p">:</span>
        <span class="n">as_variable_flags_init</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">as_variable_flags_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays_constructor</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags_init</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays_constructor</span><span class="p">:</span>
        <span class="n">native_array_flags_init</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">native_array_flags_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays_constructor</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="n">num_arrays_method</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes_method</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags_method</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags_method</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">container_flags_method</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes_method</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays_method</span><span class="p">:</span>
        <span class="n">input_dtypes_method</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_dtypes_method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays_method</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags_method</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays_method</span><span class="p">:</span>
        <span class="n">as_variable_flags_method</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">as_variable_flags_method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays_method</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags_method</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays_method</span><span class="p">:</span>
        <span class="n">native_array_flags_method</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">native_array_flags_method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays_method</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">container_flags_method</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays_method</span><span class="p">:</span>
        <span class="n">container_flags_method</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">container_flags_method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays_method</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="c1"># update variable flags to be compatible with float dtype</span>
    <span class="n">as_variable_flags_init</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">v</span> <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_float_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">as_variable_flags_init</span><span class="p">,</span> <span class="n">input_dtypes_init</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">as_variable_flags_method</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">v</span> <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_float_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">as_variable_flags_method</span><span class="p">,</span> <span class="n">input_dtypes_method</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># create args</span>
    <span class="n">args_np_constructor</span><span class="p">,</span> <span class="n">kwargs_np_constructor</span> <span class="o">=</span> <span class="n">kwargs_to_args_n_kwargs</span><span class="p">(</span>
        <span class="n">num_positional_args</span><span class="o">=</span><span class="n">num_positional_args_init</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="n">all_as_kwargs_np_init</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">args_constructor</span><span class="p">,</span> <span class="n">kwargs_constructor</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
        <span class="n">args_np</span><span class="o">=</span><span class="n">args_np_constructor</span><span class="p">,</span>
        <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np_constructor</span><span class="p">,</span>
        <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes_init</span><span class="p">,</span>
        <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags_init</span><span class="p">,</span>
        <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags_init</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">args_np_method</span><span class="p">,</span> <span class="n">kwargs_np_method</span> <span class="o">=</span> <span class="n">kwargs_to_args_n_kwargs</span><span class="p">(</span>
        <span class="n">num_positional_args</span><span class="o">=</span><span class="n">num_positional_args_method</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">all_as_kwargs_np_method</span>
    <span class="p">)</span>
    <span class="n">args_method</span><span class="p">,</span> <span class="n">kwargs_method</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
        <span class="n">args_np</span><span class="o">=</span><span class="n">args_np_method</span><span class="p">,</span>
        <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np_method</span><span class="p">,</span>
        <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes_method</span><span class="p">,</span>
        <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags_method</span><span class="p">,</span>
        <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags_method</span><span class="p">,</span>
        <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags_method</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># run</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">class_name</span><span class="p">](</span><span class="o">*</span><span class="n">args_constructor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_constructor</span><span class="p">)</span>
    <span class="n">v_np</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">init_with_v</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
                <span class="n">ins</span><span class="o">.</span><span class="n">_create_variables</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device_</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">input_dtypes_method</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">ins</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">class_name</span><span class="p">](</span><span class="o">*</span><span class="n">args_constructor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_constructor</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
        <span class="n">v_np</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">kc</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method_with_v</span><span class="p">:</span>
            <span class="n">kwargs_method</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_method</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
        <span class="n">ins</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">method_name</span><span class="p">),</span> <span class="o">*</span><span class="n">args_method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_method</span>
    <span class="p">)</span>
    <span class="c1"># compute the return with a Ground Truth backend</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="n">ground_truth_backend</span><span class="p">)</span>
    <span class="n">args_gt_constructor</span><span class="p">,</span> <span class="n">kwargs_gt_constructor</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
        <span class="n">args_np</span><span class="o">=</span><span class="n">args_np_constructor</span><span class="p">,</span>
        <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np_constructor</span><span class="p">,</span>
        <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes_init</span><span class="p">,</span>
        <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags_init</span><span class="p">,</span>
        <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags_init</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">args_gt_method</span><span class="p">,</span> <span class="n">kwargs_gt_method</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
        <span class="n">args_np</span><span class="o">=</span><span class="n">args_np_method</span><span class="p">,</span>
        <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np_method</span><span class="p">,</span>
        <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes_method</span><span class="p">,</span>
        <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags_method</span><span class="p">,</span>
        <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags_method</span><span class="p">,</span>
        <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags_method</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ins_gt</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">class_name</span><span class="p">](</span><span class="o">*</span><span class="n">args_gt_constructor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_gt_constructor</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ins_gt</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="n">v_gt</span> <span class="o">=</span> <span class="n">v_np</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">kc</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
        <span class="p">)</span>
        <span class="n">kwargs_gt_method</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_gt_method</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v_gt</span><span class="p">)</span>
    <span class="n">ret_from_gt</span><span class="p">,</span> <span class="n">ret_np_from_gt_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
        <span class="n">ins_gt</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">method_name</span><span class="p">),</span> <span class="o">*</span><span class="n">args_gt_method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_gt_method</span>
    <span class="p">)</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
    <span class="c1"># assuming value test will be handled manually in the test function</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">ret_from_gt</span>
    <span class="c1"># value test</span>
    <span class="n">value_test</span><span class="p">(</span>
        <span class="n">ret_np_flat</span><span class="o">=</span><span class="n">ret_np_flat</span><span class="p">,</span>
        <span class="n">ret_np_from_gt_flat</span><span class="o">=</span><span class="n">ret_np_from_gt_flat</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="n">rtol_</span><span class="p">,</span>
        <span class="n">atol</span><span class="o">=</span><span class="n">atol_</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="test_function"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/test_function.html#ivy.ivy_tests.test_ivy.helpers.test_function">[docs]</a><span class="k">def</span> <span class="nf">test_function</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">input_dtypes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">]],</span>
    <span class="n">as_variable_flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">with_out</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">num_positional_args</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">native_array_flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">container_flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">instance_method</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">fw</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fn_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rtol_</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol_</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-06</span><span class="p">,</span>
    <span class="n">test_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">test_gradients</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ground_truth_backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
    <span class="n">device_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">return_flat_np_arrays</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests a function that consumes (or returns) arrays for the current backend</span>
<span class="sd">    by comparing the result with numpy.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_dtypes</span>
<span class="sd">        data types of the input arguments in order.</span>
<span class="sd">    as_variable_flags</span>
<span class="sd">        dictates whether the corresponding input argument should be treated</span>
<span class="sd">        as an ivy Variable.</span>
<span class="sd">    with_out</span>
<span class="sd">        if True, the function is also tested with the optional out argument.</span>
<span class="sd">    num_positional_args</span>
<span class="sd">        number of input arguments that must be passed as positional</span>
<span class="sd">        arguments.</span>
<span class="sd">    native_array_flags</span>
<span class="sd">        dictates whether the corresponding input argument should be treated</span>
<span class="sd">        as a native array.</span>
<span class="sd">    container_flags</span>
<span class="sd">        dictates whether the corresponding input argument should be treated</span>
<span class="sd">         as an ivy Container.</span>
<span class="sd">    instance_method</span>
<span class="sd">        if True, the function is run as an instance method of the first</span>
<span class="sd">         argument (should be an ivy Array or Container).</span>
<span class="sd">    fw</span>
<span class="sd">        current backend (framework).</span>
<span class="sd">    fn_name</span>
<span class="sd">        name of the function to test.</span>
<span class="sd">    rtol_</span>
<span class="sd">        relative tolerance value.</span>
<span class="sd">    atol_</span>
<span class="sd">        absolute tolerance value.</span>
<span class="sd">    test_values</span>
<span class="sd">        if True, test for the correctness of the resulting values.</span>
<span class="sd">    test_gradients</span>
<span class="sd">        if True, test for the correctness of gradients.</span>
<span class="sd">    ground_truth_backend</span>
<span class="sd">        Ground Truth Backend to compare the result-values.</span>
<span class="sd">    device_</span>
<span class="sd">        The device on which to create arrays</span>
<span class="sd">    return_flat_np_arrays</span>
<span class="sd">        If test_values is False, this flag dictates whether the original returns are</span>
<span class="sd">        returned, or whether the flattened numpy arrays are returned.</span>
<span class="sd">    all_as_kwargs_np</span>
<span class="sd">        input arguments to the function as keyword arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        optional, return value from the function</span>
<span class="sd">    ret_gt</span>
<span class="sd">        optional, return value from the Ground Truth function</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; input_dtypes = &#39;float64&#39;</span>
<span class="sd">    &gt;&gt;&gt; as_variable_flags = False</span>
<span class="sd">    &gt;&gt;&gt; with_out = False</span>
<span class="sd">    &gt;&gt;&gt; num_positional_args = 0</span>
<span class="sd">    &gt;&gt;&gt; native_array_flags = False</span>
<span class="sd">    &gt;&gt;&gt; container_flags = False</span>
<span class="sd">    &gt;&gt;&gt; instance_method = False</span>
<span class="sd">    &gt;&gt;&gt; fw = &quot;torch&quot;</span>
<span class="sd">    &gt;&gt;&gt; fn_name = &quot;abs&quot;</span>
<span class="sd">    &gt;&gt;&gt; x = np.array([-1])</span>
<span class="sd">    &gt;&gt;&gt; test_function(input_dtypes, as_variable_flags, with_out,\</span>
<span class="sd">                            num_positional_args, native_array_flags,\</span>
<span class="sd">                            container_flags, instance_method, fw, fn_name, x=x)</span>

<span class="sd">    &gt;&gt;&gt; input_dtypes = [&#39;float64&#39;, &#39;float32&#39;]</span>
<span class="sd">    &gt;&gt;&gt; as_variable_flags = [False, True]</span>
<span class="sd">    &gt;&gt;&gt; with_out = False</span>
<span class="sd">    &gt;&gt;&gt; num_positional_args = 1</span>
<span class="sd">    &gt;&gt;&gt; native_array_flags = [True, False]</span>
<span class="sd">    &gt;&gt;&gt; container_flags = [False, False]</span>
<span class="sd">    &gt;&gt;&gt; instance_method = False</span>
<span class="sd">    &gt;&gt;&gt; fw = &quot;numpy&quot;</span>
<span class="sd">    &gt;&gt;&gt; fn_name = &quot;add&quot;</span>
<span class="sd">    &gt;&gt;&gt; x1 = np.array([1, 3, 4])</span>
<span class="sd">    &gt;&gt;&gt; x2 = np.array([-3, 15, 24])</span>
<span class="sd">    &gt;&gt;&gt; test_function(input_dtypes, as_variable_flags, with_out,\</span>
<span class="sd">                            num_positional_args, native_array_flags,\</span>
<span class="sd">                             container_flags, instance_method,\</span>
<span class="sd">                              fw, fn_name, x1=x1, x2=x2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert single values to length 1 lists</span>
    <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">native_array_flags</span><span class="p">,</span> <span class="n">container_flags</span> <span class="o">=</span> <span class="n">as_lists</span><span class="p">(</span>
        <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">native_array_flags</span><span class="p">,</span> <span class="n">container_flags</span>
    <span class="p">)</span>

    <span class="c1"># make all lists equal in length</span>
    <span class="n">num_arrays</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">container_flags</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">input_dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">as_variable_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">as_variable_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">native_array_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">native_array_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">container_flags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">container_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">container_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>

    <span class="c1"># update variable flags to be compatible with float dtype and with_out args</span>
    <span class="n">as_variable_flags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">v</span> <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_float_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_out</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># update instance_method flag to only be considered if the</span>
    <span class="c1"># first term is either an ivy.Array or ivy.Container</span>
    <span class="n">instance_method</span> <span class="o">=</span> <span class="n">instance_method</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="n">native_array_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">container_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># split the arguments into their positional and keyword components</span>
    <span class="n">args_np</span><span class="p">,</span> <span class="n">kwargs_np</span> <span class="o">=</span> <span class="n">kwargs_to_args_n_kwargs</span><span class="p">(</span>
        <span class="n">num_positional_args</span><span class="o">=</span><span class="n">num_positional_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
    <span class="p">)</span>

    <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ivy</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gradient_incompatible_function</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_dtype</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_device</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">input_device</span><span class="o">=</span><span class="n">device_</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_device_and_dtype</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="n">device_</span><span class="p">,</span>
            <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
            <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_arg_vals</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
                <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
                <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
                <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
                <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
                <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
                <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_arg_vals</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
            <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
            <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
            <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
            <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
            <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
            <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># run either as an instance method or from the API directly</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">instance_method</span><span class="p">:</span>
        <span class="n">is_instance</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">native_flag</span><span class="p">)</span> <span class="ow">or</span> <span class="n">container_flag</span>
            <span class="k">for</span> <span class="n">native_flag</span><span class="p">,</span> <span class="n">container_flag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">native_array_flags</span><span class="p">,</span> <span class="n">container_flags</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">arg_is_instance</span> <span class="o">=</span> <span class="n">is_instance</span><span class="p">[:</span><span class="n">num_arg_vals</span><span class="p">]</span>
        <span class="n">kwarg_is_instance</span> <span class="o">=</span> <span class="n">is_instance</span><span class="p">[</span><span class="n">num_arg_vals</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">arg_is_instance</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">arg_is_instance</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arg_is_instance</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">instance_idx</span> <span class="o">=</span> <span class="n">args_idxs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">index_nest</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">instance_idx</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">copy_nest</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">to_mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ivy</span><span class="o">.</span><span class="n">prune_nest_at_index</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">instance_idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kwarg_is_instance</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">instance_idx</span> <span class="o">=</span> <span class="n">kwargs_idxs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">index_nest</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">instance_idx</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">copy_nest</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">to_mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ivy</span><span class="o">.</span><span class="n">prune_nest_at_index</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">instance_idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
            <span class="n">test_unsupported_function</span><span class="p">(</span>
                <span class="n">fn</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">fn_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">ret</span><span class="p">,</span> <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
            <span class="n">instance</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">fn_name</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
            <span class="n">test_unsupported_function</span><span class="p">(</span>
                <span class="n">fn</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
            <span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="c1"># assert idx of return if the idx of the out array provided</span>
    <span class="k">if</span> <span class="n">with_out</span><span class="p">:</span>
        <span class="n">test_ret</span> <span class="o">=</span> <span class="n">ret</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="s2">&quot;out_index&quot;</span><span class="p">)</span>
            <span class="n">test_ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="s2">&quot;out_index&quot;</span><span class="p">)]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">test_ret</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">container_flags</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_ivy_container</span><span class="p">(</span><span class="n">test_ret</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">test_ret</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instance_method</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
                <span class="n">instance</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">fn_name</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
                <span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span>
            <span class="p">)</span>
        <span class="n">test_ret</span> <span class="o">=</span> <span class="n">ret</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">test_ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="s2">&quot;out_index&quot;</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="n">test_ret</span> <span class="ow">is</span> <span class="n">out</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">max</span><span class="p">(</span><span class="n">container_flags</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_inplace_support</span><span class="p">:</span>
            <span class="c1"># these backends do not always support native inplace updates</span>
            <span class="k">assert</span> <span class="n">test_ret</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="n">out</span><span class="o">.</span><span class="n">data</span>
    <span class="c1"># compute the return with a Ground Truth backend</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="n">ground_truth_backend</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ivy</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">)</span>
        <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_dtype</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
        <span class="p">)</span>
        <span class="c1"># create args</span>
        <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
                    <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
                    <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
                    <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
                    <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
                    <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
                    <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
                <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
                <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
                <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
                <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
                <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
                <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
            <span class="n">test_unsupported_function</span><span class="p">(</span>
                <span class="n">fn</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">ret_from_gt</span><span class="p">,</span> <span class="n">ret_np_from_gt_flat</span> <span class="o">=</span> <span class="n">get_ret_and_flattened_np_array</span><span class="p">(</span>
            <span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
    <span class="c1"># gradient test</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">test_gradients</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">fw</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span>
        <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">container_flags</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">instance_method</span>
    <span class="p">):</span>
        <span class="n">gradient_test</span><span class="p">(</span>
            <span class="n">fn_name</span><span class="o">=</span><span class="n">fn_name</span><span class="p">,</span>
            <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
            <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
            <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
            <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
            <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
            <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
            <span class="n">container_flags</span><span class="o">=</span><span class="n">container_flags</span><span class="p">,</span>
            <span class="n">rtol_</span><span class="o">=</span><span class="n">rtol_</span><span class="p">,</span>
            <span class="n">atol_</span><span class="o">=</span><span class="n">atol_</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># assuming value test will be handled manually in the test function</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_flat_np_arrays</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret_np_flat</span><span class="p">,</span> <span class="n">ret_np_from_gt_flat</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">ret_from_gt</span>
    <span class="c1"># value test</span>
    <span class="n">value_test</span><span class="p">(</span>
        <span class="n">ret_np_flat</span><span class="o">=</span><span class="n">ret_np_flat</span><span class="p">,</span>
        <span class="n">ret_np_from_gt_flat</span><span class="o">=</span><span class="n">ret_np_from_gt_flat</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="n">rtol_</span><span class="p">,</span>
        <span class="n">atol</span><span class="o">=</span><span class="n">atol_</span><span class="p">,</span>
        <span class="n">ground_truth_backend</span><span class="o">=</span><span class="n">ground_truth_backend</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="test_frontend_function"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/test_frontend_function.html#ivy.ivy_tests.test_ivy.helpers.test_frontend_function">[docs]</a><span class="k">def</span> <span class="nf">test_frontend_function</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">input_dtypes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">]],</span>
    <span class="n">as_variable_flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">with_out</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">with_inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_positional_args</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">native_array_flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">fw</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">frontend</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fn_tree</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-06</span><span class="p">,</span>
    <span class="n">test_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests a frontend function for the current backend by comparing the result with</span>
<span class="sd">    the function in the associated framework.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_dtypes</span>
<span class="sd">        data types of the input arguments in order.</span>
<span class="sd">    as_variable_flags</span>
<span class="sd">        dictates whether the corresponding input argument should be treated</span>
<span class="sd">        as an ivy Variable.</span>
<span class="sd">    with_out</span>
<span class="sd">        if True, the function is also tested for inplace update to an array </span>
<span class="sd">        passed to the optional out argument, should not be True together </span>
<span class="sd">        with with_inplace.</span>
<span class="sd">    with_inplace</span>
<span class="sd">        if True, the function is also tested with direct inplace update back to</span>
<span class="sd">        the inputted array, should not be True together with with_out.</span>
<span class="sd">    num_positional_args</span>
<span class="sd">        number of input arguments that must be passed as positional</span>
<span class="sd">        arguments.</span>
<span class="sd">    native_array_flags</span>
<span class="sd">        dictates whether the corresponding input argument should be treated</span>
<span class="sd">        as a native array.</span>
<span class="sd">    fw</span>
<span class="sd">        current backend (framework).</span>
<span class="sd">    frontend</span>
<span class="sd">        current frontend (framework).</span>
<span class="sd">    fn_tree</span>
<span class="sd">        Path to function in frontend framework namespace.</span>
<span class="sd">    rtol</span>
<span class="sd">        relative tolerance value.</span>
<span class="sd">    atol</span>
<span class="sd">        absolute tolerance value.</span>
<span class="sd">    test_values</span>
<span class="sd">        if True, test for the correctness of the resulting values.</span>
<span class="sd">    all_as_kwargs_np</span>
<span class="sd">        input arguments to the function as keyword arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        optional, return value from the function</span>
<span class="sd">    ret_np</span>
<span class="sd">        optional, return value from the Numpy function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert single values to length 1 lists</span>
    <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">native_array_flags</span> <span class="o">=</span> <span class="n">as_lists</span><span class="p">(</span>
        <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">native_array_flags</span>
    <span class="p">)</span>
    <span class="c1"># make all lists equal in length</span>
    <span class="n">num_arrays</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">input_dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">as_variable_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">as_variable_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">native_array_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">native_array_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>

    <span class="c1"># update variable flags to be compatible with float dtype and with_out args</span>
    <span class="n">as_variable_flags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">v</span> <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_float_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_out</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># parse function name and frontend submodules (i.e. jax.lax, jax.numpy etc.)</span>
    <span class="o">*</span><span class="n">frontend_submods</span><span class="p">,</span> <span class="n">fn_tree</span> <span class="o">=</span> <span class="n">fn_tree</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="c1"># check for unsupported dtypes in backend framework</span>
    <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">frontends</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">frontend</span><span class="p">],</span> <span class="n">fn_tree</span><span class="p">)</span>
    <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_dtype</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">function</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_device_and_dtype</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">=</span><span class="n">function</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
            <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
            <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># split the arguments into their positional and keyword components</span>
    <span class="n">args_np</span><span class="p">,</span> <span class="n">kwargs_np</span> <span class="o">=</span> <span class="n">kwargs_to_args_n_kwargs</span><span class="p">(</span>
        <span class="n">num_positional_args</span><span class="o">=</span><span class="n">num_positional_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
    <span class="p">)</span>

    <span class="c1"># create args</span>
    <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_arg_vals</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
                <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
                <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
                <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
                <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
                <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">args_ivy</span><span class="p">,</span> <span class="n">kwargs_ivy</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">args_to_ivy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_arg_vals</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
            <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
            <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
            <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
            <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
            <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">args_ivy</span><span class="p">,</span> <span class="n">kwargs_ivy</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">args_to_ivy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># frontend function</span>
    <span class="n">frontend_fn</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">frontends</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">frontend</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_tree</span><span class="p">]</span>

    <span class="c1"># check and replace NativeClass object in arguments with ivy counterparts</span>
    <span class="n">convs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;jax&quot;</span><span class="p">:</span> <span class="n">convjax</span><span class="p">,</span>
        <span class="s2">&quot;numpy&quot;</span><span class="p">:</span> <span class="n">convnumpy</span><span class="p">,</span>
        <span class="s2">&quot;tensorflow&quot;</span><span class="p">:</span> <span class="n">convtensor</span><span class="p">,</span>
        <span class="s2">&quot;torch&quot;</span><span class="p">:</span> <span class="n">convtorch</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">frontend</span> <span class="ow">in</span> <span class="n">convs</span><span class="p">:</span>
        <span class="n">conv</span> <span class="o">=</span> <span class="n">convs</span><span class="p">[</span><span class="n">frontend</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">conv</span><span class="p">,</span> <span class="n">include_derived</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">conv</span><span class="p">,</span> <span class="n">include_derived</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># run from the Ivy API directly</span>
    <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="n">test_unsupported_function</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">frontend_fn</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">frontend_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="k">if</span> <span class="n">with_out</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="k">else</span> <span class="n">ret</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">ret</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">with_out</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">with_inplace</span><span class="p">,</span> <span class="s2">&quot;only one of with_out or with_inplace can be set as True&quot;</span>
    <span class="k">if</span> <span class="n">with_out</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="c1"># pass return value to out argument</span>
        <span class="c1"># check if passed reference is correctly updated</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">frontend_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_inplace_support</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ret</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="n">out</span><span class="o">.</span><span class="n">data</span>
        <span class="k">assert</span> <span class="n">ret</span> <span class="ow">is</span> <span class="n">out</span>
    <span class="k">elif</span> <span class="n">with_inplace</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;inplace&quot;</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">frontend_fn</span><span class="p">)</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="c1"># the function provides optional inplace update</span>
            <span class="c1"># set inplace update to be True and check</span>
            <span class="c1"># if returned reference is inputted reference</span>
            <span class="c1"># and if inputted reference&#39;s content is correctly updated</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;inplace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">first_array</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">func_wrapper</span><span class="o">.</span><span class="n">_get_first_array</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">frontend_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_inplace_support</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ret</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="n">first_array</span><span class="o">.</span><span class="n">data</span>
            <span class="k">assert</span> <span class="n">first_array</span> <span class="ow">is</span> <span class="n">ret</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># the function provides inplace update by default</span>
            <span class="c1"># check if returned reference is inputted reference</span>
            <span class="n">first_array</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">func_wrapper</span><span class="o">.</span><span class="n">_get_first_array</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_inplace_support</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ret</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="n">first_array</span><span class="o">.</span><span class="n">data</span>
            <span class="k">assert</span> <span class="n">first_array</span> <span class="ow">is</span> <span class="n">ret</span>

    <span class="c1"># create NumPy args</span>
    <span class="n">args_np</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
        <span class="n">args_ivy</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">kwargs_np</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
        <span class="n">kwargs_ivy</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># temporarily set frontend framework as backend</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="n">frontend</span><span class="p">)</span>
    <span class="n">backend_returned_scalar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># check for unsupported dtypes in frontend framework</span>
        <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">frontends</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">frontend</span><span class="p">],</span> <span class="n">fn_tree</span><span class="p">)</span>
        <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_dtype</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">=</span><span class="n">function</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
        <span class="p">)</span>

        <span class="c1"># create frontend framework args</span>
        <span class="n">args_frontend</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
            <span class="n">args_np</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">kwargs_frontend</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
            <span class="n">kwargs_np</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># change ivy dtypes to native dtypes</span>
        <span class="k">if</span> <span class="s2">&quot;dtype&quot;</span> <span class="ow">in</span> <span class="n">kwargs_frontend</span><span class="p">:</span>
            <span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">as_native_dtype</span><span class="p">(</span><span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">])</span>

        <span class="c1"># change ivy device to native devices</span>
        <span class="k">if</span> <span class="s2">&quot;device&quot;</span> <span class="ow">in</span> <span class="n">kwargs_frontend</span><span class="p">:</span>
            <span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">as_native_dev</span><span class="p">(</span><span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">])</span>

        <span class="c1"># check and replace the NativeClass objects in arguments with true counterparts</span>
        <span class="n">args_frontend</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
            <span class="n">args_frontend</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">convtrue</span><span class="p">,</span> <span class="n">include_derived</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>
        <span class="n">kwargs_frontend</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
            <span class="n">kwargs_frontend</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">convtrue</span><span class="p">,</span> <span class="n">include_derived</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>

        <span class="c1"># compute the return via the frontend framework</span>
        <span class="n">frontend_fw</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">frontend</span><span class="p">]</span> <span class="o">+</span> <span class="n">frontend_submods</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
            <span class="n">test_unsupported_function</span><span class="p">(</span>
                <span class="n">fn</span><span class="o">=</span><span class="n">frontend_fw</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_tree</span><span class="p">],</span>
                <span class="n">args</span><span class="o">=</span><span class="n">args_frontend</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs_frontend</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">frontend_ret</span> <span class="o">=</span> <span class="n">frontend_fw</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_tree</span><span class="p">](</span><span class="o">*</span><span class="n">args_frontend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_frontend</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">frontend</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">backend_returned_scalar</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">frontend_ret_np_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># tuplify the frontend return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">frontend_ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">frontend_ret</span><span class="p">,)</span>
            <span class="n">frontend_ret_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_native_array</span><span class="p">)</span>
            <span class="n">frontend_ret_flat</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="n">frontend_ret_idxs</span><span class="p">)</span>
            <span class="n">frontend_ret_np_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">frontend_ret_flat</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="c1"># unset frontend framework from backend</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">backend_returned_scalar</span><span class="p">:</span>
        <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">([</span><span class="n">ret</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">flatten_and_to_np</span><span class="p">(</span><span class="n">ret</span><span class="o">=</span><span class="n">ret</span><span class="p">)</span>

    <span class="c1"># assuming value test will be handled manually in the test function</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">frontend_ret</span>

    <span class="c1"># value tests, iterating through each array in the flattened returns</span>
    <span class="n">value_test</span><span class="p">(</span>
        <span class="n">ret_np_flat</span><span class="o">=</span><span class="n">ret_np_flat</span><span class="p">,</span>
        <span class="n">ret_np_from_gt_flat</span><span class="o">=</span><span class="n">frontend_ret_np_flat</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span>
        <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
        <span class="n">ground_truth_backend</span><span class="o">=</span><span class="n">frontend</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="test_frontend_array_instance_method"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/test_frontend_array_instance_method.html#ivy.ivy_tests.test_ivy.helpers.test_frontend_array_instance_method">[docs]</a><span class="k">def</span> <span class="nf">test_frontend_array_instance_method</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">input_dtypes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">Dtype</span><span class="p">]],</span>
    <span class="n">as_variable_flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">with_out</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">num_positional_args</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">native_array_flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="n">fw</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frontend</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frontend_class</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">fn_tree</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-06</span><span class="p">,</span>
    <span class="n">test_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests a frontend instance method for the current backend by comparing the</span>
<span class="sd">    result with the function in the associated framework.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_dtypes</span>
<span class="sd">        data types of the input arguments in order.</span>
<span class="sd">    as_variable_flags</span>
<span class="sd">        dictates whether the corresponding input argument should be treated</span>
<span class="sd">        as an ivy Variable.</span>
<span class="sd">    with_out</span>
<span class="sd">        if True, the function is also tested with the optional out argument.</span>
<span class="sd">    num_positional_args</span>
<span class="sd">        number of input arguments that must be passed as positional</span>
<span class="sd">        arguments.</span>
<span class="sd">    native_array_flags</span>
<span class="sd">        dictates whether the corresponding input argument should be treated</span>
<span class="sd">        as a native array.</span>
<span class="sd">    fw</span>
<span class="sd">        current backend (framework).</span>
<span class="sd">    frontend</span>
<span class="sd">        current frontend (framework).</span>
<span class="sd">    frontend_class</span>
<span class="sd">        class in the frontend framework.</span>
<span class="sd">    fn_tree</span>
<span class="sd">        Path to function in frontend framework namespace.</span>
<span class="sd">    rtol</span>
<span class="sd">        relative tolerance value.</span>
<span class="sd">    atol</span>
<span class="sd">        absolute tolerance value.</span>
<span class="sd">    test_values</span>
<span class="sd">        if True, test for the correctness of the resulting values.</span>
<span class="sd">    all_as_kwargs_np</span>
<span class="sd">        input arguments to the function as keyword arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret</span>
<span class="sd">        optional, return value from the function</span>
<span class="sd">    ret_np</span>
<span class="sd">        optional, return value from the Numpy function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># num_positional_args ignores self, which we need to compensate for</span>
    <span class="n">num_positional_args</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># convert single values to length 1 lists</span>
    <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">native_array_flags</span> <span class="o">=</span> <span class="n">as_lists</span><span class="p">(</span>
        <span class="n">input_dtypes</span><span class="p">,</span> <span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">native_array_flags</span>
    <span class="p">)</span>
    <span class="c1"># make all lists equal in length</span>
    <span class="n">num_arrays</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_dtypes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">input_dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">as_variable_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">as_variable_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">native_array_flags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_arrays</span><span class="p">:</span>
        <span class="n">native_array_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">native_array_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>

    <span class="c1"># update variable flags to be compatible with float dtype and with_out args</span>
    <span class="n">as_variable_flags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">v</span> <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_float_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_out</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">as_variable_flags</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># parse function name and frontend submodules (i.e. jax.lax, jax.numpy etc.)</span>
    <span class="o">*</span><span class="n">frontend_submods</span><span class="p">,</span> <span class="n">fn_tree</span> <span class="o">=</span> <span class="n">fn_tree</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="c1"># check for unsupported dtypes in backend framework</span>
    <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">frontends</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">frontend</span><span class="p">],</span> <span class="n">fn_tree</span><span class="p">)</span>
    <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_dtype</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">function</span><span class="p">,</span> <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span> <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
    <span class="p">)</span>

    <span class="c1"># split the arguments into their positional and keyword components</span>
    <span class="n">args_np</span><span class="p">,</span> <span class="n">kwargs_np</span> <span class="o">=</span> <span class="n">kwargs_to_args_n_kwargs</span><span class="p">(</span>
        <span class="n">num_positional_args</span><span class="o">=</span><span class="n">num_positional_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">all_as_kwargs_np</span>
    <span class="p">)</span>

    <span class="c1"># create args</span>
    <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_arg_vals</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
                <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
                <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
                <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
                <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
                <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">args_ivy</span><span class="p">,</span> <span class="n">kwargs_ivy</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">args_to_ivy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">num_arg_vals</span><span class="p">,</span> <span class="n">args_idxs</span><span class="p">,</span> <span class="n">kwargs_idxs</span> <span class="o">=</span> <span class="n">create_args_kwargs</span><span class="p">(</span>
            <span class="n">args_np</span><span class="o">=</span><span class="n">args_np</span><span class="p">,</span>
            <span class="n">kwargs_np</span><span class="o">=</span><span class="n">kwargs_np</span><span class="p">,</span>
            <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
            <span class="n">as_variable_flags</span><span class="o">=</span><span class="n">as_variable_flags</span><span class="p">,</span>
            <span class="n">native_array_flags</span><span class="o">=</span><span class="n">native_array_flags</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">args_ivy</span><span class="p">,</span> <span class="n">kwargs_ivy</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">args_to_ivy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># get instance array</span>
    <span class="k">if</span> <span class="n">args</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">instance_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[(</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">instance_array</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># create class instance</span>
    <span class="n">class_instance</span> <span class="o">=</span> <span class="n">frontend_class</span><span class="p">(</span><span class="n">instance_array</span><span class="p">)</span>

    <span class="c1"># frontend function</span>
    <span class="n">fn_name</span> <span class="o">=</span> <span class="n">fn_tree</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">frontend_fn</span> <span class="o">=</span> <span class="n">class_instance</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">fn_name</span><span class="p">)</span>

    <span class="c1"># run from Ivy API directly</span>
    <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
        <span class="n">test_unsupported_function</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">frontend_fn</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">frontend_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="k">if</span> <span class="n">with_out</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="k">else</span> <span class="n">ret</span>

    <span class="c1"># assert idx of return if the idx of the out array provided</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">ret</span>
    <span class="k">if</span> <span class="n">with_out</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
            <span class="n">kwargs_ivy</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="c1"># case where ret is not ivy.array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">arg_info</span><span class="p">(</span><span class="n">frontend_fn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">)[</span><span class="s2">&quot;idx&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">out</span>
            <span class="n">args_ivy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args_ivy</span><span class="p">)</span>
            <span class="n">args_ivy</span><span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">arg_info</span><span class="p">(</span><span class="n">frontend_fn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">)[</span><span class="s2">&quot;idx&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                <span class="n">out</span>
            <span class="p">)</span>  <span class="c1"># case where ret is not ivy.array</span>
            <span class="n">args_ivy</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args_ivy</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">frontend_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_inplace_support</span><span class="p">:</span>
            <span class="c1"># these backends do not always support native inplace updates</span>
            <span class="k">assert</span> <span class="n">ret</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="n">out</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># create NumPy args</span>
    <span class="n">args_np</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
        <span class="n">args_ivy</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">kwargs_np</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
        <span class="n">kwargs_ivy</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># get instance array</span>
    <span class="k">if</span> <span class="n">args_np</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">args_np</span> <span class="o">==</span> <span class="p">():</span>
        <span class="n">instance_np_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs_np</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">instance_np_array</span> <span class="o">=</span> <span class="n">args_np</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># create class instance</span>
    <span class="n">class_instance_np</span> <span class="o">=</span> <span class="n">frontend_class</span><span class="p">(</span><span class="n">instance_np_array</span><span class="p">)</span>

    <span class="c1"># frontend function</span>
    <span class="n">frontend_fn_np</span> <span class="o">=</span> <span class="n">class_instance_np</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">fn_name</span><span class="p">)</span>

    <span class="c1"># remove self from all_as_kwargs_np</span>
    <span class="k">del</span> <span class="n">all_as_kwargs_np</span><span class="p">[(</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs_np</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])]</span>

    <span class="c1"># temporarily set frontend framework as backend</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="n">frontend</span><span class="p">)</span>
    <span class="n">backend_returned_scalar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># run from Ivy API directly</span>
        <span class="n">test_unsupported</span> <span class="o">=</span> <span class="n">check_unsupported_dtype</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">=</span><span class="n">frontend_fn_np</span><span class="p">,</span>
            <span class="n">input_dtypes</span><span class="o">=</span><span class="n">input_dtypes</span><span class="p">,</span>
            <span class="n">all_as_kwargs_np</span><span class="o">=</span><span class="n">all_as_kwargs_np</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># create frontend framework args</span>
        <span class="n">args_frontend</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
            <span class="n">args_np</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">kwargs_frontend</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_map</span><span class="p">(</span>
            <span class="n">kwargs_np</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ivy</span><span class="o">.</span><span class="n">native_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># change ivy dtypes to native dtypes</span>
        <span class="k">if</span> <span class="s2">&quot;dtype&quot;</span> <span class="ow">in</span> <span class="n">kwargs_frontend</span><span class="p">:</span>
            <span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">as_native_dtype</span><span class="p">(</span><span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">])</span>

        <span class="c1"># change ivy device to native devices</span>
        <span class="k">if</span> <span class="s2">&quot;device&quot;</span> <span class="ow">in</span> <span class="n">kwargs_frontend</span><span class="p">:</span>
            <span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">as_native_dev</span><span class="p">(</span><span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">])</span>

        <span class="c1"># change out argument to ivy array</span>
        <span class="k">if</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">kwargs_frontend</span><span class="p">:</span>
            <span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs_frontend</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">])</span>

        <span class="c1"># get instance array</span>
        <span class="k">if</span> <span class="n">args_frontend</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">or</span> <span class="n">args_frontend</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">frontend_instance_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs_frontend</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs_frontend</span><span class="p">[(</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs_frontend</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frontend_instance_array</span> <span class="o">=</span> <span class="n">args_frontend</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">args_frontend</span> <span class="o">=</span> <span class="n">args_frontend</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># create class instance</span>
        <span class="n">frontend_class_instance</span> <span class="o">=</span> <span class="n">frontend_class</span><span class="p">(</span><span class="n">frontend_instance_array</span><span class="p">)</span>

        <span class="c1"># frontend function</span>
        <span class="n">frontend_fn</span> <span class="o">=</span> <span class="n">frontend_class_instance</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">fn_name</span><span class="p">)</span>

        <span class="c1"># return from frontend framework</span>
        <span class="k">if</span> <span class="n">test_unsupported</span><span class="p">:</span>
            <span class="n">test_unsupported_function</span><span class="p">(</span>
                <span class="n">fn</span><span class="o">=</span><span class="n">frontend_fn</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args_frontend</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs_frontend</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">frontend_ret</span> <span class="o">=</span> <span class="n">frontend_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args_frontend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_frontend</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">frontend</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">backend_returned_scalar</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">frontend_ret_np_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># tuplify the frontend return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">frontend_ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">frontend_ret</span><span class="p">,)</span>
            <span class="n">frontend_ret_idxs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">nested_argwhere</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="n">ivy</span><span class="o">.</span><span class="n">is_array</span><span class="p">)</span>
            <span class="n">frontend_ret_flat</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">multi_index_nest</span><span class="p">(</span><span class="n">frontend_ret</span><span class="p">,</span> <span class="n">frontend_ret_idxs</span><span class="p">)</span>
            <span class="n">frontend_ret_np_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">frontend_ret_flat</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="c1"># unset frontend framework from backend</span>
    <span class="n">ivy</span><span class="o">.</span><span class="n">unset_backend</span><span class="p">()</span>

    <span class="c1"># handle scalar return</span>
    <span class="k">if</span> <span class="n">backend_returned_scalar</span><span class="p">:</span>
        <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">([</span><span class="n">ret</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret_np_flat</span> <span class="o">=</span> <span class="n">flatten_and_to_np</span><span class="p">(</span><span class="n">ret</span><span class="o">=</span><span class="n">ret</span><span class="p">)</span>

    <span class="c1"># assuming value test will be handled manually in the test function</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">frontend_ret</span>

    <span class="c1"># value tests, iterating through each array in the flattened returns</span>
    <span class="n">value_test</span><span class="p">(</span>
        <span class="n">ret_np_flat</span><span class="o">=</span><span class="n">ret_np_flat</span><span class="p">,</span>
        <span class="n">ret_np_from_gt_flat</span><span class="o">=</span><span class="n">frontend_ret_np_flat</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span>
        <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
        <span class="n">ground_truth_backend</span><span class="o">=</span><span class="n">frontend</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="c1"># Hypothesis #</span>
<span class="c1"># -----------#</span>


<div class="viewcode-block" id="array_dtypes"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/array_dtypes.html#ivy.ivy_tests.test_ivy.helpers.array_dtypes">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">array_dtypes</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">num_arrays</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;num_arrays&quot;</span><span class="p">),</span>
    <span class="n">available_dtypes</span><span class="o">=</span><span class="n">ivy_np</span><span class="o">.</span><span class="n">valid_float_dtypes</span><span class="p">,</span>
    <span class="n">shared_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a list of data types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    num_arrays</span>
<span class="sd">        number of data types to be drawn.</span>
<span class="sd">    available_dtypes</span>
<span class="sd">        universe of available data types.</span>
<span class="sd">    shared_dtype</span>
<span class="sd">        if True, all data types in the list are same.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">num_arrays</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_arrays</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">list_of_length</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">available_dtypes</span><span class="p">),</span> <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">shared_dtype</span><span class="p">:</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">list_of_length</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">available_dtypes</span><span class="p">),</span> <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unwanted_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">all_dtypes</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">available_dtypes</span><span class="p">))</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">promotion_table</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">available_dtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">pair</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">d</span> <span class="ow">in</span> <span class="n">pair</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">unwanted_types</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">available_dtypes</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">num_arrays</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dtypes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">dtypes</span></div>


<div class="viewcode-block" id="array_bools"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/array_bools.html#ivy.ivy_tests.test_ivy.helpers.array_bools">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">array_bools</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">num_arrays</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;num_arrays&quot;</span><span class="p">),</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a boolean list of a given size.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    num_arrays</span>
<span class="sd">        size of the list.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">num_arrays</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">draw</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span> <span class="n">min_size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span></div>


<div class="viewcode-block" id="lists"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/lists.html#ivy.ivy_tests.test_ivy.helpers.lists">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">lists</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a list from the dataset arg.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    arg</span>
<span class="sd">        dataset of elements.</span>
<span class="sd">    min_size</span>
<span class="sd">        least size of the list.</span>
<span class="sd">    max_size</span>
<span class="sd">        max size of the list.</span>
<span class="sd">    size_bounds</span>
<span class="sd">        if min_size or max_size is None, draw them randomly from the range</span>
<span class="sd">        [size_bounds[0], size_bounds[1]].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">integers</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">size_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_value</span><span class="o">=</span><span class="n">size_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">size_bounds</span>
        <span class="k">else</span> <span class="n">ints</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">min_size</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">integers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">min_size</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span><span class="n">integers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">max_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">))</span></div>


<div class="viewcode-block" id="dtype_and_values"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/dtype_and_values.html#ivy.ivy_tests.test_ivy.helpers.dtype_and_values">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">dtype_and_values</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">available_dtypes</span><span class="o">=</span><span class="n">ivy_np</span><span class="o">.</span><span class="n">valid_dtypes</span><span class="p">,</span>
    <span class="n">num_arrays</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">large_abs_safety_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
    <span class="n">small_abs_safety_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
    <span class="n">safety_factor_scale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">allow_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">min_num_dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_num_dims</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_dim_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_dim_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">shared_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ret_shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a list of arrays with elements from the given corresponding data types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    available_dtypes</span>
<span class="sd">        if dtype is None, data types are drawn from this list randomly.</span>
<span class="sd">    num_arrays</span>
<span class="sd">        Number of arrays to be drawn.</span>
<span class="sd">    min_value</span>
<span class="sd">        minimum value of elements in each array.</span>
<span class="sd">    max_value</span>
<span class="sd">        maximum value of elements in each array.</span>
<span class="sd">    large_abs_safety_factor</span>
<span class="sd">        A safety factor of 1 means that all values are included without limitation,</span>

<span class="sd">        when a &quot;linear&quot; safety factor scaler is used,  a safety factor of 2 means</span>
<span class="sd">        that only 50% of the range is included, a safety factor of 3 means that</span>
<span class="sd">        only 33% of the range is included etc.</span>

<span class="sd">        when a &quot;log&quot; safety factor scaler is used, a data type with maximum</span>
<span class="sd">        value of 2^32 and a safety factor of 2 transforms the maximum to 2^16.</span>
<span class="sd">    small_abs_safety_factor</span>
<span class="sd">        A safety factor of 1 means that all values are included without limitation,</span>
<span class="sd">        this has no effect on integer data types.</span>

<span class="sd">        when a &quot;linear&quot; safety factor scaler is used, a data type with minimum</span>
<span class="sd">        representable number of 0.0001 and a safety factor of 2 transforms the</span>
<span class="sd">        minimum to 0.0002, a safety factor of 3 transforms the minimum to 0.0003 etc.</span>

<span class="sd">        when a &quot;log&quot; safety factor scaler is used, a data type with minimum</span>
<span class="sd">        representable number of 0.5 * 2^-16 and a safety factor of 2 transforms the</span>
<span class="sd">        minimum to 0.5 * 2^-8, a safety factor of 3 transforms the minimum to 0.5 * 2^-4</span>
<span class="sd">    safety_factor_scale</span>
<span class="sd">        The operation to use when calculating the maximum value of the list. Can be</span>
<span class="sd">        &quot;linear&quot; or &quot;log&quot;. Default value = &quot;linear&quot;.</span>
<span class="sd">    allow_inf</span>
<span class="sd">        if True, allow inf in the arrays.</span>
<span class="sd">    allow_nan</span>
<span class="sd">        if True, allow Nans in the arrays.</span>
<span class="sd">    exclude_min</span>
<span class="sd">        if True, exclude the minimum limit.</span>
<span class="sd">    exclude_max</span>
<span class="sd">        if True, exclude the maximum limit.</span>
<span class="sd">    min_num_dims</span>
<span class="sd">        minimum size of the shape tuple.</span>
<span class="sd">    max_num_dims</span>
<span class="sd">        maximum size of the shape tuple.</span>
<span class="sd">    min_dim_size</span>
<span class="sd">        minimum value of each integer in the shape tuple.</span>
<span class="sd">    max_dim_size</span>
<span class="sd">        maximum value of each integer in the shape tuple.</span>
<span class="sd">    shape</span>
<span class="sd">        shape of the arrays in the list.</span>
<span class="sd">    shared_dtype</span>
<span class="sd">        if True, if dtype is None, a single shared dtype is drawn for all arrays.</span>
<span class="sd">    ret_shape</span>
<span class="sd">        if True, the shape of the arrays is also returned.</span>
<span class="sd">    dtype</span>
<span class="sd">        A list of data types for the given arrays.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a list of dtype and arrays (as lists).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_dim_size</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">min_dim_size</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">min_dim_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_dim_size</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">max_dim_size</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">max_dim_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">available_dtypes</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">available_dtypes</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">available_dtypes</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">num_arrays</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">array_dtypes</span><span class="p">(</span>
                <span class="n">num_arrays</span><span class="o">=</span><span class="n">num_arrays</span><span class="p">,</span>
                <span class="n">available_dtypes</span><span class="o">=</span><span class="n">available_dtypes</span><span class="p">,</span>
                <span class="n">shared_dtype</span><span class="o">=</span><span class="n">shared_dtype</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span>
                <span class="n">get_shape</span><span class="p">(</span>
                    <span class="n">min_num_dims</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
                    <span class="n">max_num_dims</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
                    <span class="n">min_dim_size</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span>
                    <span class="n">max_dim_size</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;shape&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_arrays</span><span class="p">):</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">draw</span><span class="p">(</span>
                <span class="n">array_values</span><span class="p">(</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                    <span class="n">allow_inf</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">,</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                    <span class="n">large_abs_safety_factor</span><span class="o">=</span><span class="n">large_abs_safety_factor</span><span class="p">,</span>
                    <span class="n">small_abs_safety_factor</span><span class="o">=</span><span class="n">small_abs_safety_factor</span><span class="p">,</span>
                    <span class="n">safety_factor_scale</span><span class="o">=</span><span class="n">safety_factor_scale</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">num_arrays</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">dtype</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ret_shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">shape</span>
    <span class="k">return</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">values</span></div>


<div class="viewcode-block" id="dtype_values_axis"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/dtype_values_axis.html#ivy.ivy_tests.test_ivy.helpers.dtype_values_axis">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">dtype_values_axis</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">available_dtypes</span><span class="p">,</span>
    <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">large_abs_safety_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
    <span class="n">small_abs_safety_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
    <span class="n">safety_factor_scale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">allow_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">min_num_dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_num_dims</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_dim_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_dim_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">shared_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">min_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">valid_axis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_neg_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">min_axes_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_axes_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">force_int_axis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ret_shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws an array with elements from the given data type, and a random axis of</span>
<span class="sd">    the array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    available_dtypes</span>
<span class="sd">        if dtype is None, data type is drawn from this list randomly.</span>
<span class="sd">    min_value</span>
<span class="sd">        minimum value of elements in the array.</span>
<span class="sd">    max_value</span>
<span class="sd">        maximum value of elements in the array.</span>
<span class="sd">    large_abs_safety_factor</span>
<span class="sd">        A safety factor of 1 means that all values are included without limitation,</span>

<span class="sd">        when a &quot;linear&quot; safety factor scaler is used,  a safety factor of 2 means</span>
<span class="sd">        that only 50% of the range is included, a safety factor of 3 means that</span>
<span class="sd">        only 33% of the range is included etc.</span>

<span class="sd">        when a &quot;log&quot; safety factor scaler is used, a data type with maximum</span>
<span class="sd">        value of 2^32 and a safety factor of 2 transforms the maximum to 2^16.</span>
<span class="sd">    small_abs_safety_factor</span>
<span class="sd">        A safety factor of 1 means that all values are included without limitation,</span>
<span class="sd">        this has no effect on integer data types.</span>

<span class="sd">        when a &quot;linear&quot; safety factor scaler is used, a data type with minimum</span>
<span class="sd">        representable number of 0.0001 and a safety factor of 2 transforms the</span>
<span class="sd">        minimum to 0.0002, a safety factor of 3 transforms the minimum to 0.0003 etc.</span>

<span class="sd">        when a &quot;log&quot; safety factor scaler is used, a data type with minimum</span>
<span class="sd">        representable number of 0.5 * 2^-16 and a safety factor of 2 transforms the</span>
<span class="sd">        minimum to 0.5 * 2^-8, a safety factor of 3 transforms the minimum to 0.5 * 2^-4</span>
<span class="sd">    safety_factor_scale</span>
<span class="sd">        The operation to use when calculating the maximum value of the list. Can be</span>
<span class="sd">        &quot;linear&quot; or &quot;log&quot;. Default value = &quot;linear&quot;.</span>
<span class="sd">    allow_inf</span>
<span class="sd">        if True, allow inf in the array.</span>
<span class="sd">    allow_nan</span>
<span class="sd">        if True, allow Nans in the arrays.</span>
<span class="sd">    exclude_min</span>
<span class="sd">        if True, exclude the minimum limit.</span>
<span class="sd">    exclude_max</span>
<span class="sd">        if True, exclude the maximum limit.</span>
<span class="sd">    min_num_dims</span>
<span class="sd">        minimum size of the shape tuple.</span>
<span class="sd">    max_num_dims</span>
<span class="sd">        maximum size of the shape tuple.</span>
<span class="sd">    min_dim_size</span>
<span class="sd">        minimum value of each integer in the shape tuple.</span>
<span class="sd">    max_dim_size</span>
<span class="sd">        maximum value of each integer in the shape tuple.</span>
<span class="sd">    valid_axis</span>
<span class="sd">        if True, a valid axis will be drawn from the array dimensions.</span>
<span class="sd">    allow_neg_axes</span>
<span class="sd">        if True, returned axes may include negative axes.</span>
<span class="sd">    min_axes_size</span>
<span class="sd">        minimum size of the axis tuple.</span>
<span class="sd">    max_axes_size</span>
<span class="sd">        maximum size of the axis tuple.</span>
<span class="sd">    force_int_axis</span>
<span class="sd">        if True, and only one axis is drawn, the returned axis will be an integer.</span>
<span class="sd">    shape</span>
<span class="sd">        shape of the array. if None, a random shape is drawn.</span>
<span class="sd">    shared_dtype</span>
<span class="sd">        if True, if dtype is None, a single shared dtype is drawn for all arrays.</span>
<span class="sd">    min_axis</span>
<span class="sd">        if shape is None, axis is drawn from the range [min_axis, max_axis].</span>
<span class="sd">    max_axis</span>
<span class="sd">        if shape is None, axis is drawn from the range [min_axis, max_axis].</span>
<span class="sd">    ret_shape</span>
<span class="sd">        if True, the shape of the arrays is also returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a dtype, an array (as list), and an axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">dtype_and_values</span><span class="p">(</span>
            <span class="n">available_dtypes</span><span class="o">=</span><span class="n">available_dtypes</span><span class="p">,</span>
            <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
            <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
            <span class="n">large_abs_safety_factor</span><span class="o">=</span><span class="n">large_abs_safety_factor</span><span class="p">,</span>
            <span class="n">small_abs_safety_factor</span><span class="o">=</span><span class="n">small_abs_safety_factor</span><span class="p">,</span>
            <span class="n">safety_factor_scale</span><span class="o">=</span><span class="n">safety_factor_scale</span><span class="p">,</span>
            <span class="n">allow_inf</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
            <span class="n">allow_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">,</span>
            <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
            <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
            <span class="n">min_num_dims</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
            <span class="n">max_num_dims</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
            <span class="n">min_dim_size</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span>
            <span class="n">max_dim_size</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
            <span class="n">shared_dtype</span><span class="o">=</span><span class="n">shared_dtype</span><span class="p">,</span>
            <span class="n">ret_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">dtype</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">arr_shape</span> <span class="o">=</span> <span class="n">results</span>
    <span class="k">if</span> <span class="n">valid_axis</span> <span class="ow">or</span> <span class="n">shape</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
                <span class="n">get_axis</span><span class="p">(</span>
                    <span class="n">shape</span><span class="o">=</span><span class="n">arr_shape</span><span class="p">,</span>
                    <span class="n">min_size</span><span class="o">=</span><span class="n">min_axes_size</span><span class="p">,</span>
                    <span class="n">max_size</span><span class="o">=</span><span class="n">max_axes_size</span><span class="p">,</span>
                    <span class="n">allow_neg</span><span class="o">=</span><span class="n">allow_neg_axes</span><span class="p">,</span>
                    <span class="n">force_int</span><span class="o">=</span><span class="n">force_int_axis</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">min_axis</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">max_axis</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ret_shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">shape</span>
    <span class="k">return</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">axis</span></div>


<span class="c1"># taken from</span>
<span class="c1"># https://github.com/data-apis/array-api-tests/array_api_tests/test_manipulation_functions.py</span>
<div class="viewcode-block" id="reshape_shapes"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/reshape_shapes.html#ivy.ivy_tests.test_ivy.helpers.reshape_shapes">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">reshape_shapes</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a random shape with the same number of elements as the given shape.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    shape</span>
<span class="sd">        list/strategy/tuple of integers representing an array shape.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a tuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">rshape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">))</span>
    <span class="c1"># assume(all(side &lt;= MAX_SIDE for side in rshape))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rshape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">()):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rshape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">rshape</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rshape</span><span class="p">)</span></div>


<span class="c1"># taken from https://github.com/HypothesisWorks/hypothesis/issues/1115</span>
<div class="viewcode-block" id="subsets"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/subsets.html#ivy.ivy_tests.test_ivy.helpers.subsets">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">subsets</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a subset of elements from the given elements.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    elements</span>
<span class="sd">        set of elements to be drawn from.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a subset of elements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">()))</span></div>


<div class="viewcode-block" id="array_n_indices_n_axis"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/array_n_indices_n_axis.html#ivy.ivy_tests.test_ivy.helpers.array_n_indices_n_axis">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">array_n_indices_n_axis</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">array_dtypes</span><span class="p">,</span>
    <span class="n">indices_dtypes</span><span class="o">=</span><span class="n">ivy_np</span><span class="o">.</span><span class="n">valid_int_dtypes</span><span class="p">,</span>
    <span class="n">disable_random_axis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">boolean_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">min_num_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_num_dims</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_dim_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_dim_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">first_dimension_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generates two arrays x &amp; indices, the values in the indices array are indices</span>
<span class="sd">    of the array x. Draws an integers randomly from the minimum and maximum number of</span>
<span class="sd">    positional arguments a given function can take.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array_dtypes</span>
<span class="sd">        list of data type to draw the array dtype from.</span>
<span class="sd">    indices_dtypes</span>
<span class="sd">        list of data type to draw the indices dtype from.</span>
<span class="sd">    disable_random_axis</span>
<span class="sd">        axis is set to -1 when True. Randomly generated with hypothesis if False.</span>
<span class="sd">    allow_inf</span>
<span class="sd">        inf values are allowed to be generated in the values array when True.</span>
<span class="sd">    min_num_dims</span>
<span class="sd">        The minimum number of dimensions the arrays can have.</span>
<span class="sd">    max_num_dims</span>
<span class="sd">        The maximum number of dimensions the arrays can have.</span>
<span class="sd">    min_dim_size</span>
<span class="sd">        The minimum size of the dimensions of the arrays.</span>
<span class="sd">    max_dim_size</span>
<span class="sd">        The maximum size of the dimensions of the arrays.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that can be used in the @given hypothesis decorator</span>
<span class="sd">    which generates arrays of values and indices.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    @given(</span>
<span class="sd">        array_n_indices_n_axis=array_n_indices_n_axis(</span>
<span class="sd">            array_dtypes=helpers.get_dtypes(&quot;valid&quot;),</span>
<span class="sd">            indices_dtypes=helpers.get_dtypes(&quot;integer&quot;),</span>
<span class="sd">            boolean_mask=False,</span>
<span class="sd">            min_num_dims=1,</span>
<span class="sd">            max_num_dims=5,</span>
<span class="sd">            min_dim_size=1,</span>
<span class="sd">            max_dim_size=10</span>
<span class="sd">            )</span>
<span class="sd">    )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_dtype</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x_shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">dtype_and_values</span><span class="p">(</span>
            <span class="n">available_dtypes</span><span class="o">=</span><span class="n">array_dtypes</span><span class="p">,</span>
            <span class="n">allow_inf</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
            <span class="n">ret_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">min_num_dims</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
            <span class="n">max_num_dims</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
            <span class="n">min_dim_size</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span>
            <span class="n">max_dim_size</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">disable_random_axis</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">ints</span><span class="p">(</span>
                <span class="n">min_value</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_shape</span><span class="p">),</span>
                <span class="n">max_value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x_shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">boolean_mask</span><span class="p">:</span>
        <span class="n">indices_dtype</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">dtype_and_values</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bool&quot;</span><span class="p">],</span>
                <span class="n">min_num_dims</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
                <span class="n">max_num_dims</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
                <span class="n">min_dim_size</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span>
                <span class="n">max_dim_size</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_axis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first_dimension_only</span><span class="p">:</span>
            <span class="n">max_axis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">indices_dtype</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">dtype_and_values</span><span class="p">(</span>
                <span class="n">available_dtypes</span><span class="o">=</span><span class="n">indices_dtypes</span><span class="p">,</span>
                <span class="n">allow_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">max_value</span><span class="o">=</span><span class="n">max_axis</span><span class="p">,</span>
                <span class="n">min_num_dims</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
                <span class="n">max_num_dims</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
                <span class="n">min_dim_size</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span>
                <span class="n">max_dim_size</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x_dtype</span><span class="p">,</span> <span class="n">indices_dtype</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">axis</span></div>


<span class="k">def</span> <span class="nf">_zeroing_and_casting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cast_type</span><span class="p">):</span>
    <span class="c1"># covnert -0.0 to 0.0</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">cast_type</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">_clamp_value</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype_info</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">dtype_info</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dtype_info</span><span class="o">.</span><span class="n">max</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">dtype_info</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dtype_info</span><span class="o">.</span><span class="n">min</span>
    <span class="k">return</span> <span class="n">x</span>


<div class="viewcode-block" id="array_values"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/array_values.html#ivy.ivy_tests.test_ivy.helpers.array_values">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">array_values</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">,</span>
    <span class="n">shape</span><span class="p">,</span>
    <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_min</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">exclude_max</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">large_abs_safety_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
    <span class="n">small_abs_safety_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
    <span class="n">safety_factor_scale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a list (of lists) of a given shape containing values of a given data type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    dtype</span>
<span class="sd">        data type of the elements of the list.</span>
<span class="sd">    shape</span>
<span class="sd">        shape of the required list.</span>
<span class="sd">    min_value</span>
<span class="sd">        minimum value of elements in the list.</span>
<span class="sd">    max_value</span>
<span class="sd">        maximum value of elements in the list.</span>
<span class="sd">    allow_nan</span>
<span class="sd">        if True, allow Nans in the list.</span>
<span class="sd">    allow_subnormal</span>
<span class="sd">        if True, allow subnormals in the list.</span>
<span class="sd">    allow_inf</span>
<span class="sd">        if True, allow inf in the list.</span>
<span class="sd">    exclude_min</span>
<span class="sd">        if True, exclude the minimum limit.</span>
<span class="sd">    exclude_max</span>
<span class="sd">        if True, exclude the maximum limit.</span>
<span class="sd">    large_abs_safety_factor</span>
<span class="sd">        A safety factor of 1 means that all values are included without limitation,</span>

<span class="sd">        when a &quot;linear&quot; safety factor scaler is used,  a safety factor of 2 means</span>
<span class="sd">        that only 50% of the range is included, a safety factor of 3 means that</span>
<span class="sd">        only 33% of the range is included etc.</span>

<span class="sd">        when a &quot;log&quot; safety factor scaler is used, a data type with maximum</span>
<span class="sd">        value of 2^32 and a safety factor of 2 transforms the maximum to 2^16.</span>
<span class="sd">    small_abs_safety_factor</span>
<span class="sd">        A safety factor of 1 means that all values are included without limitation,</span>
<span class="sd">        this has no effect on integer data types.</span>

<span class="sd">        when a &quot;linear&quot; safety factor scaler is used, a data type with minimum</span>
<span class="sd">        representable number of 0.0001 and a safety factor of 2 transforms the</span>
<span class="sd">        minimum to 0.0002, a safety factor of 3 transforms the minimum to 0.0003 etc.</span>

<span class="sd">        when a &quot;log&quot; safety factor scaler is used, a data type with minimum</span>
<span class="sd">        representable number of 0.5 * 2^-16 and a safety factor of 2 transforms the</span>
<span class="sd">        minimum to 0.5 * 2^-8, a safety factor of 3 transforms the minimum to 0.5 * 2^-4</span>
<span class="sd">    safety_factor_scale</span>
<span class="sd">        The operation to use when calculating the maximum value of the list. Can be</span>
<span class="sd">        &quot;linear&quot; or &quot;log&quot;. Default value = &quot;linear&quot;.</span>

<span class="sd">    In the case of min_value or max_value is not in the valid range</span>
<span class="sd">    the invalid value will be replaced by data type limit, the range</span>
<span class="sd">    of the numbers in that case is not preserved.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        A strategy that draws a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">small_abs_safety_factor</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;small_abs_safety_factor must be &gt;= 1&quot;</span>
    <span class="k">assert</span> <span class="n">large_abs_safety_factor</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;large_value_safety_factor must be &gt;= 1&quot;</span>

    <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">shape</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">*=</span> <span class="n">dim</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">draw</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;float&quot;</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="n">kind_dtype</span> <span class="o">=</span> <span class="s2">&quot;float&quot;</span>
        <span class="n">dtype_info</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;int&quot;</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="n">kind_dtype</span> <span class="o">=</span> <span class="s2">&quot;int&quot;</span>
        <span class="n">dtype_info</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;bool&quot;</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="n">kind_dtype</span> <span class="o">=</span> <span class="s2">&quot;bool&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> is not a valid data type that can be generated,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; only integers, floats and booleans are allowed.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">kind_dtype</span> <span class="o">!=</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">min_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">dtype_info</span><span class="o">.</span><span class="n">min</span>
            <span class="n">b_scale_min</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">_clamp_value</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">dtype_info</span><span class="p">)</span>
            <span class="n">b_scale_min</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">max_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">dtype_info</span><span class="o">.</span><span class="n">max</span>
            <span class="n">b_scale_max</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">_clamp_value</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="n">dtype_info</span><span class="p">)</span>
            <span class="n">b_scale_max</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">assert</span> <span class="n">max_value</span> <span class="o">&gt;=</span> <span class="n">min_value</span>

        <span class="c1"># Scale the values</span>
        <span class="k">if</span> <span class="n">safety_factor_scale</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b_scale_min</span><span class="p">:</span>
                <span class="n">min_value</span> <span class="o">=</span> <span class="n">min_value</span> <span class="o">/</span> <span class="n">large_abs_safety_factor</span>
            <span class="k">if</span> <span class="n">b_scale_max</span><span class="p">:</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span> <span class="o">/</span> <span class="n">large_abs_safety_factor</span>
            <span class="k">if</span> <span class="n">kind_dtype</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">:</span>
                <span class="n">abs_smallest_val</span> <span class="o">=</span> <span class="n">dtype_info</span><span class="o">.</span><span class="n">smallest_normal</span> <span class="o">*</span> <span class="n">small_abs_safety_factor</span>
        <span class="k">elif</span> <span class="n">safety_factor_scale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b_scale_min</span><span class="p">:</span>
                <span class="n">min_sign</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_value</span><span class="p">)</span>
                <span class="n">min_value</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">min_value</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">large_abs_safety_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_sign</span>
            <span class="k">if</span> <span class="n">b_scale_max</span><span class="p">:</span>
                <span class="n">max_sign</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="p">)</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">large_abs_safety_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_sign</span>
            <span class="k">if</span> <span class="n">kind_dtype</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">:</span>
                <span class="n">m</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">frexp</span><span class="p">(</span><span class="n">dtype_info</span><span class="o">.</span><span class="n">smallest_normal</span><span class="p">)</span>
                <span class="n">abs_smallest_val</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">e</span> <span class="o">/</span> <span class="n">small_abs_safety_factor</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safety_factor_scale</span><span class="si">}</span><span class="s2"> is not a valid safety factor scale.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; use &#39;log&#39; or &#39;linear&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">kind_dtype</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exclude_min</span><span class="p">:</span>
                <span class="n">min_value</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">exclude_max</span><span class="p">:</span>
                <span class="n">max_value</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
                <span class="n">list_of_length</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">min_value</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_value</span><span class="p">)),</span> <span class="n">length</span><span class="o">=</span><span class="n">size</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">kind_dtype</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">:</span>
            <span class="n">floats_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;float16&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cast_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float16&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span>
                <span class="s2">&quot;bfloat16&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cast_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">},</span>
                <span class="s2">&quot;float32&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cast_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">},</span>
                <span class="s2">&quot;float64&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cast_type&quot;</span><span class="p">:</span> <span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">64</span><span class="p">},</span>
            <span class="p">}</span>
            <span class="c1"># The smallest possible value is determined by one of the arguments</span>
            <span class="k">if</span> <span class="n">min_value</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">abs_smallest_val</span> <span class="ow">or</span> <span class="n">max_value</span> <span class="o">&lt;</span> <span class="n">abs_smallest_val</span><span class="p">:</span>
                <span class="n">float_strategy</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                    <span class="c1"># Using np.array to assert that value</span>
                    <span class="c1"># can be represented of compatible width.</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">min_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;cast_type&quot;</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">max_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;cast_type&quot;</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">,</span>
                    <span class="n">allow_subnormal</span><span class="o">=</span><span class="n">allow_subnormal</span><span class="p">,</span>
                    <span class="n">allow_infinity</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">float_strategy</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">one_of</span><span class="p">(</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                        <span class="n">min_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="n">min_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;cast_type&quot;</span><span class="p">]</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">max_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="o">-</span><span class="n">abs_smallest_val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;cast_type&quot;</span><span class="p">]</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">allow_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">,</span>
                        <span class="n">allow_subnormal</span><span class="o">=</span><span class="n">allow_subnormal</span><span class="p">,</span>
                        <span class="n">allow_infinity</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                        <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                        <span class="n">min_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="n">abs_smallest_val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;cast_type&quot;</span><span class="p">]</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">max_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="n">max_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;cast_type&quot;</span><span class="p">]</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">allow_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">,</span>
                        <span class="n">allow_subnormal</span><span class="o">=</span><span class="n">allow_subnormal</span><span class="p">,</span>
                        <span class="n">allow_infinity</span><span class="o">=</span><span class="n">allow_inf</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="n">floats_info</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                        <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
                <span class="n">list_of_length</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">float_strategy</span><span class="p">,</span>
                    <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">list_of_length</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span> <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>

    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_shape"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_shape.html#ivy.ivy_tests.test_ivy.helpers.get_shape">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">min_num_dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_num_dims</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_dim_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_dim_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a tuple of integers drawn randomly from [min_dim_size, max_dim_size]</span>
<span class="sd">     of size drawn from min_num_dims to max_num_dims. Useful for randomly</span>
<span class="sd">     drawing the shape of an array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    allow_none</span>
<span class="sd">        if True, allow for the result to be None.</span>
<span class="sd">    min_num_dims</span>
<span class="sd">        minimum size of the tuple.</span>
<span class="sd">    max_num_dims</span>
<span class="sd">        maximum size of the tuple.</span>
<span class="sd">    min_dim_size</span>
<span class="sd">        minimum value of each integer in the tuple.</span>
<span class="sd">    max_dim_size</span>
<span class="sd">        maximum value of each integer in the tuple.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a tuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
            <span class="o">|</span> <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span>
                <span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">),</span>
                <span class="n">min_size</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
                <span class="n">max_size</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span>
                <span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">),</span>
                <span class="n">min_size</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
                <span class="n">max_size</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">shape</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="none_or_list_of_floats"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/none_or_list_of_floats.html#ivy.ivy_tests.test_ivy.helpers.none_or_list_of_floats">[docs]</a><span class="k">def</span> <span class="nf">none_or_list_of_floats</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">,</span>
    <span class="n">size</span><span class="p">,</span>
    <span class="n">min_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">no_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws a List containing Nones or Floats.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dtype</span>
<span class="sd">        float data type (&#39;float16&#39;, &#39;float32&#39;, or &#39;float64&#39;).</span>
<span class="sd">    size</span>
<span class="sd">        size of the list required.</span>
<span class="sd">    min_value</span>
<span class="sd">        lower bound for values in the list</span>
<span class="sd">    max_value</span>
<span class="sd">        upper bound for values in the list</span>
<span class="sd">    exclude_min</span>
<span class="sd">        if True, exclude the min_value</span>
<span class="sd">    exclude_max</span>
<span class="sd">        if True, exclude the max_value</span>
<span class="sd">    no_none</span>
<span class="sd">        if True, List does not contains None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that draws a List containing Nones or Floats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">no_none</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float16&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">list_of_length</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">floats</span><span class="p">(</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float32&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">list_of_length</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float64&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">list_of_length</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
                    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float16&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">list_of_length</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
                <span class="o">|</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float32&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">list_of_length</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
                <span class="o">|</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float64&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">list_of_length</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
                <span class="o">|</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
                    <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
                    <span class="n">allow_subnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">exclude_min</span><span class="o">=</span><span class="n">exclude_min</span><span class="p">,</span>
                    <span class="n">exclude_max</span><span class="o">=</span><span class="n">exclude_max</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="get_mean_std"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_mean_std.html#ivy.ivy_tests.test_ivy.helpers.get_mean_std">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">get_mean_std</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws two integers representing the mean and standard deviation for a given data</span>
<span class="sd">    type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    dtype</span>
<span class="sd">        data type.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that can be used in the @given hypothesis decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">none_or_list_of_floats</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_bounds"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_bounds.html#ivy.ivy_tests.test_ivy.helpers.get_bounds">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">get_bounds</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws two integers low, high for a given data type such that low &lt; high.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    dtype</span>
<span class="sd">        data type.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that can be used in the @given hypothesis decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;int&quot;</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">array_values</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">low</span> <span class="o">==</span> <span class="n">high</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">get_bounds</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">none_or_list_of_floats</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">get_bounds</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span></div>


<div class="viewcode-block" id="get_axis"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/get_axis.html#ivy.ivy_tests.test_ivy.helpers.get_axis">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">get_axis</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">shape</span><span class="p">,</span>
    <span class="n">allow_neg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="nb">sorted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">force_tuple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">force_int</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws one or more axis for the given shape.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    shape</span>
<span class="sd">        shape of the array as a tuple, or a hypothesis strategy from which the shape</span>
<span class="sd">        will be drawn</span>
<span class="sd">    allow_neg</span>
<span class="sd">        boolean; if True, allow negative axes to be drawn</span>
<span class="sd">    allow_none</span>
<span class="sd">        boolean; if True, allow None to be drawn</span>
<span class="sd">    sorted</span>
<span class="sd">        boolean; if True, and a tuple of axes is drawn, tuple is sorted in increasing</span>
<span class="sd">        fashion</span>
<span class="sd">    unique</span>
<span class="sd">        boolean; if True, and a tuple of axes is drawn, all axes drawn will be unique</span>
<span class="sd">    min_size</span>
<span class="sd">        int or hypothesis strategy; if a tuple of axes is drawn, the minimum number of</span>
<span class="sd">        axes drawn</span>
<span class="sd">    max_size</span>
<span class="sd">        int or hypothesis strategy; if a tuple of axes is drawn, the maximum number of</span>
<span class="sd">        axes drawn.</span>
<span class="sd">        If None and unique is True, then it is set to the number of axes in the shape</span>
<span class="sd">    force_tuple</span>
<span class="sd">        boolean, if true, all axis will be returned as a tuple. If force_tuple and</span>
<span class="sd">        force_int are true, then an AssertionError is raised</span>
<span class="sd">    force_int</span>
<span class="sd">        boolean, if true, all axis will be returned as an int. If force_tuple and</span>
<span class="sd">        force_int are true, then an AssertionError is raised</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that can be used in the @given hypothesis decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">force_int</span> <span class="ow">and</span> <span class="n">force_tuple</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">&quot;Cannot return an int and a tuple. If &quot;</span>
        <span class="s2">&quot;both are valid then set &#39;force_int&#39; &quot;</span>
        <span class="s2">&quot;and &#39;force_tuple&#39; to False.&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Draw values from any strategies given</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">min_size</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">min_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">_internal</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">max_size</span><span class="p">)</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">lower_axes_bound</span> <span class="o">=</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">allow_neg</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">unique_by</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">shape</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">if</span> <span class="n">unique</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">max_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">unique</span><span class="p">:</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">min_size</span><span class="p">)</span>

    <span class="n">valid_strategies</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
        <span class="n">valid_strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">())</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force_tuple</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">valid_strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">just</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="o">-</span><span class="n">lower_axes_bound</span><span class="p">,</span> <span class="n">axes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">force_int</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">valid_strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">just</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="o">-</span><span class="n">lower_axes_bound</span><span class="p">,</span> <span class="n">axes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="p">,</span>
                    <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">,</span>
                    <span class="n">unique_by</span><span class="o">=</span><span class="n">unique_by</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="n">axis</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">one_of</span><span class="p">(</span><span class="o">*</span><span class="n">valid_strategies</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">sorted</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">sort_key</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">max_len</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ele</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">ele</span> <span class="o">+</span> <span class="n">max_len</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">ele</span>

            <span class="n">axis</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ele</span><span class="p">:</span> <span class="n">sort_key</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">axes</span><span class="p">)))</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="num_positional_args"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/num_positional_args.html#ivy.ivy_tests.test_ivy.helpers.num_positional_args">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">num_positional_args</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws an integers randomly from the minimum and maximum number of positional</span>
<span class="sd">    arguments a given function can take.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    fn_name</span>
<span class="sd">        name of the function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that can be used in the @given hypothesis decorator.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    @given(</span>
<span class="sd">        num_positional_args=num_positional_args(fn_name=&quot;floor_divide&quot;)</span>
<span class="sd">    )</span>
<span class="sd">    @given(</span>
<span class="sd">        num_positional_args=num_positional_args(fn_name=&quot;add&quot;)</span>
<span class="sd">    )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_positional_only</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_keyword_only</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fn_name_key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fn_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name_key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">fn_name_key</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;self&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">:</span>
            <span class="n">num_positional_only</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">:</span>
            <span class="n">num_keyword_only</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">:</span>
            <span class="n">num_keyword_only</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">num_positional_only</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">num_keyword_only</span><span class="p">))</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="num_positional_args_from_fn"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/num_positional_args_from_fn.html#ivy.ivy_tests.test_ivy.helpers.num_positional_args_from_fn">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">num_positional_args_from_fn</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws an integers randomly from the minimum and maximum number of positional</span>
<span class="sd">    arguments a given function can take.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    draw</span>
<span class="sd">        special function that draws data randomly (but is reproducible) from a given</span>
<span class="sd">        data-set (ex. list).</span>
<span class="sd">    fn</span>
<span class="sd">        name of the function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A strategy that can be used in the @given hypothesis decorator.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    @given(</span>
<span class="sd">        num_positional_args=num_positional_args_from_fn(fn=&quot;floor_divide&quot;)</span>
<span class="sd">    )</span>
<span class="sd">    @given(</span>
<span class="sd">        num_positional_args=num_positional_args_from_fn(fn=&quot;add&quot;)</span>
<span class="sd">    )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_positional_only</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_keyword_only</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">:</span>
            <span class="n">num_positional_only</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">:</span>
            <span class="n">num_keyword_only</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">:</span>
            <span class="n">num_keyword_only</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">ints</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">num_positional_only</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">num_keyword_only</span><span class="p">))</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="bool_val_flags"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/bool_val_flags.html#ivy.ivy_tests.test_ivy.helpers.bool_val_flags">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">bool_val_flags</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">cl_arg</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">cl_arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="n">cl_arg</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">())</span></div>


<div class="viewcode-block" id="handle_cmd_line_args"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/handle_cmd_line_args.html#ivy.ivy_tests.test_ivy.helpers.handle_cmd_line_args">[docs]</a><span class="k">def</span> <span class="nf">handle_cmd_line_args</span><span class="p">(</span><span class="n">test_fn</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ivy_tests.test_ivy.conftest</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">FW_STRS</span><span class="p">,</span>
        <span class="n">TEST_BACKENDS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># first[1:-2] 5 arguments are all fixtures</span>
    <span class="nd">@given</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">data</span><span class="p">())</span>
    <span class="nd">@settings</span><span class="p">(</span><span class="n">max_examples</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_fn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">get_command_line_flags</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fw</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">flag</span><span class="p">,</span> <span class="n">backend_string</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># skip test if device is gpu and backend is numpy</span>
        <span class="k">if</span> <span class="s2">&quot;gpu&quot;</span> <span class="ow">in</span> <span class="n">device</span> <span class="ow">and</span> <span class="n">ivy</span><span class="o">.</span><span class="n">current_backend_str</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span><span class="p">:</span>
            <span class="c1"># Numpy does not support GPU</span>
            <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># randomly draw a backend if not set</span>
            <span class="n">backend_string</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">FW_STRS</span><span class="p">))</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">TEST_BACKENDS</span><span class="p">[</span><span class="n">backend_string</span><span class="p">]()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use the one which is parametrized</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">global</span> <span class="n">frontend_fw</span>
        <span class="c1"># Reset the global variable,</span>
        <span class="c1"># only set if frontend fw is inferred</span>
        <span class="n">frontend_fw</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">full_fn_test_path</span> <span class="o">=</span> <span class="n">test_fn</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_fn_test_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">full_fn_test_path</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;test_frontends&quot;</span><span class="p">:</span>
                <span class="n">frontend_fw</span> <span class="o">=</span> <span class="n">TEST_BACKENDS</span><span class="p">[</span><span class="n">full_fn_test_path</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">5</span><span class="p">:]]</span>

        <span class="c1"># set backend using the context manager</span>
        <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">use</span><span class="p">:</span>
            <span class="c1"># inspecting for keyword arguments in test function</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">test_fn</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cmd_line_args</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
                        <span class="n">bool_val_flags</span><span class="p">(</span><span class="n">get_command_line_flags</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fw&quot;</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;fw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fw</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="n">backend_string</span>
                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
            <span class="k">return</span> <span class="n">test_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_fn</span></div>


<div class="viewcode-block" id="gradient_incompatible_function"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/gradient_incompatible_function.html#ivy.ivy_tests.test_ivy.helpers.gradient_incompatible_function">[docs]</a><span class="k">def</span> <span class="nf">gradient_incompatible_function</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="n">ivy</span><span class="o">.</span><span class="n">supports_gradients</span>
        <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;computes_gradients&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">fn</span><span class="o">.</span><span class="n">computes_gradients</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="seed"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/seed.html#ivy.ivy_tests.test_ivy.helpers.seed">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="n">draw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="arrays_and_axes"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/arrays_and_axes.html#ivy.ivy_tests.test_ivy.helpers.arrays_and_axes">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">arrays_and_axes</span><span class="p">(</span>
    <span class="n">draw</span><span class="p">,</span>
    <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">min_num_dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_num_dims</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_dim_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_dim_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">get_shape</span><span class="p">(</span>
                <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">min_num_dims</span><span class="o">=</span><span class="n">min_num_dims</span><span class="p">,</span>
                <span class="n">max_num_dims</span><span class="o">=</span><span class="n">max_num_dims</span><span class="p">,</span>
                <span class="n">min_dim_size</span><span class="o">=</span><span class="n">min_dim_size</span><span class="p">,</span>
                <span class="n">max_dim_size</span><span class="o">=</span><span class="n">max_dim_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">arrays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="n">arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">draw</span><span class="p">(</span>
                <span class="n">array_values</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=-</span><span class="mi">200</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">all_axes_ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">all_axes_ranges</span><span class="p">:</span>
            <span class="n">all_axes_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_axes_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">one_of</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span> <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">tuples</span><span class="p">(</span><span class="o">*</span><span class="n">all_axes_ranges</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">arrays</span><span class="p">,</span> <span class="n">axes</span></div>


<div class="viewcode-block" id="x_and_filters"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/x_and_filters.html#ivy.ivy_tests.test_ivy.helpers.x_and_filters">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">x_and_filters</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">transpose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">depthwise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">strides</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">([</span><span class="s2">&quot;SAME&quot;</span><span class="p">,</span> <span class="s2">&quot;VALID&quot;</span><span class="p">]))</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">filter_shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">get_shape</span><span class="p">(</span><span class="n">min_num_dims</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num_dims</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">min_dim_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_dim_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">input_channels</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">output_channels</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">dilations</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">get_dtypes</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">data_format</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">([</span><span class="s2">&quot;NCHW&quot;</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data_format</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">([</span><span class="s2">&quot;NWC&quot;</span><span class="p">,</span> <span class="s2">&quot;NCW&quot;</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_format</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">([</span><span class="s2">&quot;NDHWC&quot;</span><span class="p">,</span> <span class="s2">&quot;NCDHW&quot;</span><span class="p">]))</span>

    <span class="n">x_dim</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="n">output_shape</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_dim</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
            <span class="n">get_shape</span><span class="p">(</span>
                <span class="n">min_num_dims</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num_dims</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">min_dim_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_dim_size</span><span class="o">=</span><span class="mi">20</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">output_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ivy</span><span class="o">.</span><span class="n">deconv_length</span><span class="p">(</span>
                    <span class="n">x_dim</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">strides</span><span class="p">,</span> <span class="n">filter_shape</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">padding</span><span class="p">,</span> <span class="n">dilations</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">min_x</span> <span class="o">=</span> <span class="n">filter_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">filter_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dilations</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">x_dim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="mi">100</span><span class="p">)))</span>
        <span class="n">x_dim</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x_dim</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">depthwise</span><span class="p">:</span>
        <span class="n">filter_shape</span> <span class="o">=</span> <span class="n">filter_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">input_channels</span><span class="p">,</span> <span class="n">output_channels</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filter_shape</span> <span class="o">=</span> <span class="n">filter_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">input_channels</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">data_format</span> <span class="o">==</span> <span class="s2">&quot;NHWC&quot;</span> <span class="ow">or</span> <span class="n">data_format</span> <span class="o">==</span> <span class="s2">&quot;NWC&quot;</span> <span class="ow">or</span> <span class="n">data_format</span> <span class="o">==</span> <span class="s2">&quot;NDHWC&quot;</span><span class="p">:</span>
        <span class="n">x_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,)</span> <span class="o">+</span> <span class="n">x_dim</span> <span class="o">+</span> <span class="p">(</span><span class="n">input_channels</span><span class="p">,)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">input_channels</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_dim</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">array_values</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">x_shape</span><span class="p">,</span>
            <span class="n">large_abs_safety_factor</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">small_abs_safety_factor</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">safety_factor_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">array_values</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">filter_shape</span><span class="p">,</span>
            <span class="n">large_abs_safety_factor</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">small_abs_safety_factor</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">safety_factor_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">dtype</span><span class="p">,</span>
            <span class="n">vals</span><span class="p">,</span>
            <span class="n">filters</span><span class="p">,</span>
            <span class="n">dilations</span><span class="p">,</span>
            <span class="n">data_format</span><span class="p">,</span>
            <span class="n">strides</span><span class="p">,</span>
            <span class="n">padding</span><span class="p">,</span>
            <span class="n">output_shape</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">dilations</span><span class="p">,</span> <span class="n">data_format</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span> <span class="n">padding</span></div>


<span class="c1">#      From array-api repo     #</span>
<span class="c1"># ---------------------------- #</span>


<span class="k">def</span> <span class="nf">_broadcast_shapes</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Broadcasts `shape1` and `shape2`&quot;&quot;&quot;</span>
    <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape1</span><span class="p">)</span>
    <span class="n">N2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape2</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">N1</span> <span class="o">-</span> <span class="n">N</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">N1</span> <span class="o">-</span> <span class="n">N</span> <span class="o">+</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">shape1</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">N2</span> <span class="o">-</span> <span class="n">N</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">N2</span> <span class="o">-</span> <span class="n">N</span> <span class="o">+</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="n">shape2</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">d1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2</span>
        <span class="k">elif</span> <span class="n">d2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d1</span>
        <span class="k">elif</span> <span class="n">d1</span> <span class="o">==</span> <span class="n">d2</span><span class="p">:</span>
            <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Broadcast error&quot;</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>


<span class="c1"># from array-api repo</span>
<div class="viewcode-block" id="broadcast_shapes"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/broadcast_shapes.html#ivy.ivy_tests.test_ivy.helpers.broadcast_shapes">[docs]</a><span class="k">def</span> <span class="nf">broadcast_shapes</span><span class="p">(</span><span class="o">*</span><span class="n">shapes</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;shapes=[] must be non-empty&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_broadcast_shapes</span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapes</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_broadcast_shapes</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">shapes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span></div>


<span class="c1"># np.prod and others have overflow and math.prod is Python 3.8+ only</span>
<div class="viewcode-block" id="prod"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/prod.html#ivy.ivy_tests.test_ivy.helpers.prod">[docs]</a><span class="k">def</span> <span class="nf">prod</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


<span class="c1"># from array-api repo</span>
<div class="viewcode-block" id="mutually_broadcastable_shapes"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/mutually_broadcastable_shapes.html#ivy.ivy_tests.test_ivy.helpers.mutually_broadcastable_shapes">[docs]</a><span class="k">def</span> <span class="nf">mutually_broadcastable_shapes</span><span class="p">(</span>
    <span class="n">num_shapes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">base_shape</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">min_dims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_dims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">min_side</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_side</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">max_dims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_dims</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">base_shape</span><span class="p">),</span> <span class="n">min_dims</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_side</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_side</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">base_shape</span><span class="p">[</span><span class="o">-</span><span class="n">max_dims</span><span class="p">:]</span> <span class="o">+</span> <span class="p">(</span><span class="n">min_side</span><span class="p">,))</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">nph</span><span class="o">.</span><span class="n">mutually_broadcastable_shapes</span><span class="p">(</span>
            <span class="n">num_shapes</span><span class="o">=</span><span class="n">num_shapes</span><span class="p">,</span>
            <span class="n">base_shape</span><span class="o">=</span><span class="n">base_shape</span><span class="p">,</span>
            <span class="n">min_dims</span><span class="o">=</span><span class="n">min_dims</span><span class="p">,</span>
            <span class="n">max_dims</span><span class="o">=</span><span class="n">max_dims</span><span class="p">,</span>
            <span class="n">min_side</span><span class="o">=</span><span class="n">min_side</span><span class="p">,</span>
            <span class="n">max_side</span><span class="o">=</span><span class="n">max_side</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">BS</span><span class="p">:</span> <span class="n">BS</span><span class="o">.</span><span class="n">input_shapes</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">shapes</span><span class="p">:</span> <span class="nb">all</span><span class="p">(</span><span class="n">prod</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">))</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="array_and_broadcastable_shape"><a class="viewcode-back" href="../../../../ivy_tests/test_ivy/helpers/array_and_broadcastable_shape.html#ivy.ivy_tests.test_ivy.helpers.array_and_broadcastable_shape">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span> <span class="nf">array_and_broadcastable_shape</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns an array and a shape that the array can be broadcast to&quot;&quot;&quot;</span>
    <span class="n">in_shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">nph</span><span class="o">.</span><span class="n">array_shapes</span><span class="p">(</span><span class="n">min_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_dims</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">nph</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">in_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
    <span class="n">to_shape</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
        <span class="n">mutually_broadcastable_shapes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">base_shape</span><span class="o">=</span><span class="n">in_shape</span><span class="p">)</span>
        <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">S</span><span class="p">:</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">broadcast_shapes</span><span class="p">(</span><span class="n">in_shape</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">s</span><span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;shape&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">to_shape</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Ivy Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>